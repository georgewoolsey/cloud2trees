<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Estimate CBH using tree crown polygons and normalized point cloud data — trees_cbh • cloud2trees</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimate CBH using tree crown polygons and normalized point cloud data — trees_cbh"><meta name="description" content="trees_cbh() uses the input tree crown polygons (e.g. as exported by raster2trees()) with the columns
treeID and tree_height_m to estimate tree CBH using height normalized point cloud data (e.g. as exported by cloud2raster()).
CBH is extracted directly from the height normalized point cloud using the process outlined in Viedma et al. (2024) and implemented via ladderfuelsr_cbh().
There are likely to be trees for which there is insufficient data in the point cloud to successfully estimate CBH. The user can elect to estimate missing CBH values which is accomplished via:
Attempt to extract CBH from the sample of trees elected by the user (tree_sample_n,tree_sample_prop parameter) using ladderfuelsr_cbh()
Successfully extracted CBH trees become training data used to estimate the height-CBH allometry relationship that is spatially informed using the relative tree location compared to the training data
The height and location predicting CBH model built from the point cloud training data is used to predict CBH for the non-training (i.e. missing CBH) data

"><meta property="og:description" content="trees_cbh() uses the input tree crown polygons (e.g. as exported by raster2trees()) with the columns
treeID and tree_height_m to estimate tree CBH using height normalized point cloud data (e.g. as exported by cloud2raster()).
CBH is extracted directly from the height normalized point cloud using the process outlined in Viedma et al. (2024) and implemented via ladderfuelsr_cbh().
There are likely to be trees for which there is insufficient data in the point cloud to successfully estimate CBH. The user can elect to estimate missing CBH values which is accomplished via:
Attempt to extract CBH from the sample of trees elected by the user (tree_sample_n,tree_sample_prop parameter) using ladderfuelsr_cbh()
Successfully extracted CBH trees become training data used to estimate the height-CBH allometry relationship that is spatially informed using the relative tree location compared to the training data
The height and location predicting CBH model built from the point cloud training data is used to predict CBH for the non-training (i.e. missing CBH) data

"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">cloud2trees</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/cloud2trees-setup.html">Setup</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Overview</h6></li>
    <li><a class="dropdown-item" href="../articles/cloud2trees-overview.html">Overview</a></li>
    <li><a class="dropdown-item" href="../articles/cloud2trees-pipeline.html">cloud2trees Pipeline</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Tutorials</h6></li>
    <li><a class="dropdown-item" href="../articles/cloud2raster-tutorial.html">Creating DTM and CHM rasters</a></li>
    <li><a class="dropdown-item" href="../articles/raster2trees-tutorial.html">Generating a tree list from a CHM</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/georgewoolsey/cloud2trees/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Estimate CBH using tree crown polygons and normalized point cloud data</h1>
      <small class="dont-index">Source: <a href="https://github.com/georgewoolsey/cloud2trees/blob/main/R/trees_cbh.R" class="external-link"><code>R/trees_cbh.R</code></a></small>
      <div class="d-none name"><code>trees_cbh.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>trees_cbh()</code> uses the input tree crown polygons (e.g. as exported by <code><a href="raster2trees.html">raster2trees()</a></code>) with the columns
<code>treeID</code> and <code>tree_height_m</code> to estimate tree CBH using height normalized point cloud data (e.g. as exported by <code><a href="cloud2raster.html">cloud2raster()</a></code>).</p>
<p>CBH is extracted directly from the height normalized point cloud using the process outlined in Viedma et al. (2024) and implemented via <code><a href="ladderfuelsr_cbh.html">ladderfuelsr_cbh()</a></code>.</p>
<p>There are likely to be trees for which there is insufficient data in the point cloud to successfully estimate CBH. The user can elect to estimate missing CBH values which is accomplished via:</p><ul><li><p>Attempt to extract CBH from the sample of trees elected by the user (<code>tree_sample_n</code>,<code>tree_sample_prop</code> parameter) using <code><a href="ladderfuelsr_cbh.html">ladderfuelsr_cbh()</a></code></p></li>
<li><p>Successfully extracted CBH trees become training data used to estimate the height-CBH allometry relationship that is spatially informed using the relative tree location compared to the training data</p></li>
<li><p>The height and location predicting CBH model built from the point cloud training data is used to predict CBH for the non-training (i.e. missing CBH) data</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">trees_cbh</span><span class="op">(</span></span>
<span>  <span class="va">trees_poly</span>,</span>
<span>  norm_las <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  tree_sample_n <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  tree_sample_prop <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  which_cbh <span class="op">=</span> <span class="st">"lowest"</span>,</span>
<span>  estimate_missing_cbh <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  min_vhp_n <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  voxel_grain_size_m <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  dist_btwn_bins_m <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  min_fuel_layer_ht_m <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  lad_pct_gap <span class="op">=</span> <span class="fl">25</span>,</span>
<span>  lad_pct_base <span class="op">=</span> <span class="fl">25</span>,</span>
<span>  num_jump_steps <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  min_lad_pct <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  frst_layer_min_ht_m <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  force_same_crs <span class="op">=</span> <span class="cn">F</span>,</span>
<span>  outfolder <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-trees-poly">trees_poly<a class="anchor" aria-label="anchor" href="#arg-trees-poly"></a></dt>
<dd><p>must be one of the following that has required attributes <code>treeID</code> and <code>tree_height_m</code>:</p><ul><li><p><code>sf</code> class object with POLYGON geometry (see <code><a href="https://r-spatial.github.io/sf/reference/st_geometry_type.html" class="external-link">sf::st_geometry_type()</a></code>). Recommended for smaller tree lists (e.g. &lt;100k) that can fit in memory.</p></li>
<li><p>character vector with the path to a single or multiple spatial files that can be read by <code><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">sf::st_read()</a></code> and have POLYGON geometry. Recommended for large tree lists (e.g. 100k+) that might cause memory issues.</p></li>
<li><p>character with the path to a directory that has "final_detected_crowns*" files from <code><a href="cloud2trees.html">cloud2trees()</a></code> or <code><a href="raster2trees.html">raster2trees()</a></code>. Recommended for large tree lists (e.g. 100k+) that might cause memory issues.</p></li>
</ul></dd>


<dt id="arg-norm-las">norm_las<a class="anchor" aria-label="anchor" href="#arg-norm-las"></a></dt>
<dd><p>character. a directory with nomalized las files, the path of a single .laz|.las file", -or- an object of class <code>LAS</code>.
It is your responsibility to ensure that the point cloud is projected the same as the <code>trees_poly</code> data</p></dd>


<dt id="arg-tree-sample-n-tree-sample-prop">tree_sample_n, tree_sample_prop<a class="anchor" aria-label="anchor" href="#arg-tree-sample-n-tree-sample-prop"></a></dt>
<dd><p>numeric. Provide either <code>tree_sample_n</code>, the number of trees, or <code>tree_sample_prop</code>, the
proportion of the trees to attempt to extract a CBH from the point cloud for.
If neither are supplied, <code>tree_sample_n = 333</code> will be used. If both are supplied, <code>tree_sample_n</code> will be used.
Increasing <code>tree_sample_prop</code> toward one (1) will increase the processing time, perhaps significantly depending on the number of trees in the <code>trees_poly</code> data.</p></dd>


<dt id="arg-which-cbh">which_cbh<a class="anchor" aria-label="anchor" href="#arg-which-cbh"></a></dt>
<dd><p>character. One of: "lowest"; "highest"; or "max_lad". See Viedma et al. (2024) reference.</p><ul><li><p>"lowest" - Height of the CBH of the segmented tree based on the last distance found in its profile</p></li>
<li><p>"highest" - Height of the CBH of the segmented tree based on the maximum distance found in its profile</p></li>
<li><p>"max_lad" - Height of the CBH of the segmented tree based on the maximum LAD percentage</p></li>
</ul></dd>


<dt id="arg-estimate-missing-cbh">estimate_missing_cbh<a class="anchor" aria-label="anchor" href="#arg-estimate-missing-cbh"></a></dt>
<dd><p>logical. even if the <code>tree_sample_prop</code> parameter is set to "1", it is not likely that CBH will be extracted successfully from every tree.
Should the missing CBH values be estimated using the tree height and location information based on trees for which CBH is successfully extracted?</p></dd>


<dt id="arg-min-vhp-n">min_vhp_n<a class="anchor" aria-label="anchor" href="#arg-min-vhp-n"></a></dt>
<dd><p>numeric. the minimum number of vertical height profiles (VHPs) needed to estimate a CBH.</p></dd>


<dt id="arg-voxel-grain-size-m">voxel_grain_size_m<a class="anchor" aria-label="anchor" href="#arg-voxel-grain-size-m"></a></dt>
<dd><p>numeric. horizontal resolution (suggested 1 meter for lad profiles and 10 meters for LAI maps). See <code>grain.size</code> in <code><a href="https://rdrr.io/pkg/leafR/man/lad.voxels.html" class="external-link">leafR::lad.voxels()</a></code></p></dd>


<dt id="arg-dist-btwn-bins-m">dist_btwn_bins_m<a class="anchor" aria-label="anchor" href="#arg-dist-btwn-bins-m"></a></dt>
<dd><p>numeric. value for the actual height bin step (in meters). See <code>step</code> in <code><a href="https://rdrr.io/pkg/LadderFuelsR/man/get_gaps_fbhs.html" class="external-link">LadderFuelsR::get_gaps_fbhs()</a></code></p></dd>


<dt id="arg-min-fuel-layer-ht-m">min_fuel_layer_ht_m<a class="anchor" aria-label="anchor" href="#arg-min-fuel-layer-ht-m"></a></dt>
<dd><p>numeric. value for the actual minimum base height (in meters). See <code>min_height</code> in <code><a href="https://rdrr.io/pkg/LadderFuelsR/man/get_gaps_fbhs.html" class="external-link">LadderFuelsR::get_gaps_fbhs()</a></code></p></dd>


<dt id="arg-lad-pct-gap">lad_pct_gap<a class="anchor" aria-label="anchor" href="#arg-lad-pct-gap"></a></dt>
<dd><p>numeric. value of the percentile threshold used to identify gaps (default percentile 25th). See <code>perc_gap</code> in <code><a href="https://rdrr.io/pkg/LadderFuelsR/man/get_gaps_fbhs.html" class="external-link">LadderFuelsR::get_gaps_fbhs()</a></code></p></dd>


<dt id="arg-lad-pct-base">lad_pct_base<a class="anchor" aria-label="anchor" href="#arg-lad-pct-base"></a></dt>
<dd><p>numeric. value of the percentile threshold used to identify fuels layers base height (default percentile 25th). See <code>perc_base</code> in <code><a href="https://rdrr.io/pkg/LadderFuelsR/man/get_gaps_fbhs.html" class="external-link">LadderFuelsR::get_gaps_fbhs()</a></code></p></dd>


<dt id="arg-num-jump-steps">num_jump_steps<a class="anchor" aria-label="anchor" href="#arg-num-jump-steps"></a></dt>
<dd><p>numeric. value for the number of height bin steps that can be jumped to reshape fuels layers. See <code>number_steps</code> in <code><a href="https://rdrr.io/pkg/LadderFuelsR/man/get_real_fbh.html" class="external-link">LadderFuelsR::get_real_fbh()</a></code></p></dd>


<dt id="arg-min-lad-pct">min_lad_pct<a class="anchor" aria-label="anchor" href="#arg-min-lad-pct"></a></dt>
<dd><p>numeric. value for the minimum required LAD percentage in a fuel layer. See <code>threshold</code> in <code><a href="https://rdrr.io/pkg/LadderFuelsR/man/get_layers_lad.html" class="external-link">LadderFuelsR::get_layers_lad()</a></code></p></dd>


<dt id="arg-frst-layer-min-ht-m">frst_layer_min_ht_m<a class="anchor" aria-label="anchor" href="#arg-frst-layer-min-ht-m"></a></dt>
<dd><p>numeric. value for the depth height of the first fuel layer. If the first fuel layer has the maximum LAD and its depth is greater than the indicated value, then this fuel layer is considered as the CBH of the tree. On the contrary, if its depth is &lt;= the value, the CBH with maximum LAD will be the second fuel layer, although it has not the maximum LAD. See <code>hdepth1_height</code> in <code><a href="https://rdrr.io/pkg/LadderFuelsR/man/get_cbh_metrics.html" class="external-link">LadderFuelsR::get_cbh_metrics()</a></code></p></dd>


<dt id="arg-force-same-crs">force_same_crs<a class="anchor" aria-label="anchor" href="#arg-force-same-crs"></a></dt>
<dd><p>logical. force the same crs between the point cloud and polygon if confident that data are in same projection.
data created by a <code>cloud2trees</code> pipeline (e.g. <code><a href="cloud2raster.html">cloud2raster()</a></code>) will always have the same projection even if not recognized by <code>lidR</code> functions</p></dd>


<dt id="arg-outfolder">outfolder<a class="anchor" aria-label="anchor" href="#arg-outfolder"></a></dt>
<dd><p>string. The path of a folder to write the model data to.
Note, in the actual missing value estimation many RF models are estimated and model averaging is used.
However, only the first estimated model is saved in this export which does not fully represent the process used to fill in missing values.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Returns a spatial data frame of individual trees.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>

<ul><li><p><a href="https://doi.org/10.1111/2041-210X.14427" class="external-link">https://doi.org/10.1111/2041-210X.14427</a>
Viedma, O., Silva, C. A., Moreno, J. M., &amp; Hudak, A. T. (2024). LadderFuelsR: A new automated tool for vertical fuel continuity analysis and crown base height detection using light detection and ranging. Methods in Ecology and Evolution.
<a href="https://github.com/olgaviedma/LadderFuelsR" class="external-link">https://github.com/olgaviedma/LadderFuelsR</a></p></li>
<li><p><a href="https://doi.org/10.3390/rs11010092" class="external-link">https://doi.org/10.3390/rs11010092</a>
Almeida, D. R. A. D., Stark, S. C., Shao, G., Schietti, J., Nelson, B. W., Silva, C. A., ... &amp; Brancalion, P. H. S. (2019). Optimizing the remote detection of tropical rainforest structure with airborne lidar: Leaf area profile sensitivity to pulse density and spatial sampling. Remote Sensing, 11(1), 92.
<a href="https://github.com/DRAAlmeida/leafR" class="external-link">https://github.com/DRAAlmeida/leafR</a></p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span> <span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="co"># example tree crown polygons</span></span></span>
<span class="r-in"><span> <span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"cloud2trees"</span>,<span class="st">"extdata"</span>,<span class="st">"crowns_poly.gpkg"</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="va">crowns</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">f</span>, quiet <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="co"># example normalized las files are in this directory</span></span></span>
<span class="r-in"><span> <span class="va">norm_d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"cloud2trees"</span>,<span class="st">"extdata"</span>,<span class="st">"norm_las"</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="co"># now run the trees_cbh()</span></span></span>
<span class="r-in"><span> <span class="va">trees_cbh_ans</span> <span class="op">&lt;-</span> <span class="fu">trees_cbh</span><span class="op">(</span></span></span>
<span class="r-in"><span>    trees_poly <span class="op">=</span> <span class="va">crowns</span></span></span>
<span class="r-in"><span>    , norm_las <span class="op">=</span> <span class="va">norm_d</span></span></span>
<span class="r-in"><span>    , tree_sample_n <span class="op">=</span> <span class="fl">44</span></span></span>
<span class="r-in"><span>    , estimate_missing_cbh <span class="op">=</span> <span class="cn">T</span></span></span>
<span class="r-in"><span>    , force_same_crs <span class="op">=</span> <span class="cn">T</span></span></span>
<span class="r-in"><span>   <span class="op">)</span></span></span>
<span class="r-in"><span> <span class="co"># what?</span></span></span>
<span class="r-in"><span> <span class="va">trees_cbh_ans</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="va">trees_cbh_ans</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">treeID</span>,<span class="fu">tidyselect</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"cbh"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="co"># spatial polygons</span></span></span>
<span class="r-in"><span> <span class="va">trees_cbh_ans</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>   <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">tree_cbh_m</span>,color<span class="op">=</span><span class="va">is_training_cbh</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="co"># relationship between height and cbh</span></span></span>
<span class="r-in"><span> <span class="va">trees_cbh_ans</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">tree_height_m</span>, y <span class="op">=</span> <span class="va">tree_cbh_m</span>, color<span class="op">=</span><span class="va">is_training_cbh</span><span class="op">)</span></span></span>
<span class="r-in"><span>     <span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="co"># tabulate training data</span></span></span>
<span class="r-in"><span> <span class="va">trees_cbh_ans</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>   <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>   <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">is_training_cbh</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="co">#### try a file list</span></span></span>
<span class="r-in"><span> <span class="co">#### Recommended for large tree lists (e.g. 100k+) that might cause memory issues.</span></span></span>
<span class="r-in"><span> <span class="co"># we'll split the crowns</span></span></span>
<span class="r-in"><span> <span class="co"># as is done automatically for tree lists &gt;250k by raster2trees() and cloud2trees()</span></span></span>
<span class="r-in"><span> <span class="va">crowns</span> <span class="op">&lt;-</span> <span class="va">crowns</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>   <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>     <span class="co"># makes 2 groups of data</span></span></span>
<span class="r-in"><span>     grp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="op">)</span></span></span>
<span class="r-in"><span> <span class="co"># make file names</span></span></span>
<span class="r-in"><span> <span class="va">my_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="va">fnm_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">my_dir</span>, <span class="st">"crowns1.gpkg"</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="va">fnm_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">my_dir</span>, <span class="st">"crowns2.gpkg"</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="va">fnm_1</span></span></span>
<span class="r-in"><span> <span class="co"># write the data</span></span></span>
<span class="r-in"><span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">st_write</a></span><span class="op">(</span><span class="va">crowns</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">grp</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span>, dsn <span class="op">=</span> <span class="va">fnm_1</span>, append <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="co"># grp 1</span></span></span>
<span class="r-in"><span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">st_write</a></span><span class="op">(</span><span class="va">crowns</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">grp</span><span class="op">==</span><span class="fl">2</span><span class="op">)</span>, dsn <span class="op">=</span> <span class="va">fnm_2</span>, append <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="co"># grp 2</span></span></span>
<span class="r-in"><span> <span class="co"># try trees_cbh with our file list</span></span></span>
<span class="r-in"><span> <span class="va">flist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">fnm_1</span>,<span class="va">fnm_2</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="co"># now run the trees_cbh()</span></span></span>
<span class="r-in"><span> <span class="va">trees_cbh_ans2</span> <span class="op">&lt;-</span> <span class="fu">trees_cbh</span><span class="op">(</span></span></span>
<span class="r-in"><span>  trees_poly <span class="op">=</span> <span class="va">flist</span></span></span>
<span class="r-in"><span>  , norm_las <span class="op">=</span> <span class="va">norm_d</span></span></span>
<span class="r-in"><span>  , tree_sample_n <span class="op">=</span> <span class="fl">44</span></span></span>
<span class="r-in"><span>  , estimate_missing_cbh <span class="op">=</span> <span class="cn">T</span></span></span>
<span class="r-in"><span>  , force_same_crs <span class="op">=</span> <span class="cn">T</span></span></span>
<span class="r-in"><span> <span class="op">)</span></span></span>
<span class="r-in"><span> <span class="co"># tabulate training data</span></span></span>
<span class="r-in"><span> <span class="va">trees_cbh_ans2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>   <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>   <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">is_training_cbh</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by George Woolsey.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

