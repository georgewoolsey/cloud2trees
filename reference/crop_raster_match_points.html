<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>internal functions to extract raster values at point locations — crop_raster_match_points • cloud2trees</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="internal functions to extract raster values at point locations — crop_raster_match_points"><meta name="description" content="internal functions to extract raster values at point locations used by trees_type() and tree_biomass() for LANDFIRE rasters
for the most part, these functions take point and raster data as inputs
the general process is (see trees_type() for example):
crop_raster_match_points()
check for undesirable or NA values in the point_values from crop_raster_match_points()
if undesirable values:
reclass_landfire_rast() or reclass_foresttype_rast()
agg_fill_rast_match_points(), see details above function definition
use the point_values from agg_fill_rast_match_points() if not null
otherwise, use the point_values from crop_raster_match_points()



Note for development: currently looking at entire bounding box of points (or study boundary if defined) to fill NA raster cells
this is the most computationally intensive process, especially for large areas (&amp;gt;100k ha), fine resolution rasters (&amp;lt;=30m)
if the points are uniformly or randomly dispersed across the entire AOI, the current process is likely the best process
if the points are clustered in groups across the AOI, future development could attempt to group points into clusters
and iterate over the raster filling process for the cluster groups which may allow for finer resolution raster data as input (instead of aggregating)
see examples"><meta property="og:description" content="internal functions to extract raster values at point locations used by trees_type() and tree_biomass() for LANDFIRE rasters
for the most part, these functions take point and raster data as inputs
the general process is (see trees_type() for example):
crop_raster_match_points()
check for undesirable or NA values in the point_values from crop_raster_match_points()
if undesirable values:
reclass_landfire_rast() or reclass_foresttype_rast()
agg_fill_rast_match_points(), see details above function definition
use the point_values from agg_fill_rast_match_points() if not null
otherwise, use the point_values from crop_raster_match_points()



Note for development: currently looking at entire bounding box of points (or study boundary if defined) to fill NA raster cells
this is the most computationally intensive process, especially for large areas (&amp;gt;100k ha), fine resolution rasters (&amp;lt;=30m)
if the points are uniformly or randomly dispersed across the entire AOI, the current process is likely the best process
if the points are clustered in groups across the AOI, future development could attempt to group points into clusters
and iterate over the raster filling process for the cluster groups which may allow for finer resolution raster data as input (instead of aggregating)
see examples"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">cloud2trees</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/cloud2trees-setup.html">Setup</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Overview</h6></li>
    <li><a class="dropdown-item" href="../articles/cloud2trees-overview.html">Overview</a></li>
    <li><a class="dropdown-item" href="../articles/cloud2trees-pipeline.html">cloud2trees Pipeline</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Tutorials</h6></li>
    <li><a class="dropdown-item" href="../articles/cloud2raster-tutorial.html">Creating DTM and CHM rasters</a></li>
    <li><a class="dropdown-item" href="../articles/raster2trees-tutorial.html">Generating a tree list from a CHM</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/georgewoolsey/cloud2trees/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>internal functions to extract raster values at point locations</h1>
      <small class="dont-index">Source: <a href="https://github.com/georgewoolsey/cloud2trees/blob/main/R/utils_rast_points.R" class="external-link"><code>R/utils_rast_points.R</code></a></small>
      <div class="d-none name"><code>crop_raster_match_points.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>internal functions to extract raster values at point locations used by <code><a href="trees_type.html">trees_type()</a></code> and tree_biomass() for LANDFIRE rasters
for the most part, these functions take point and raster data as inputs
the general process is (see <code><a href="trees_type.html">trees_type()</a></code> for example):</p><ul><li><p>crop_raster_match_points()</p></li>
<li><p>check for undesirable or NA values in the point_values from crop_raster_match_points()</p></li>
<li><p>if undesirable values:</p><ul><li><p>reclass_landfire_rast() or reclass_foresttype_rast()</p></li>
<li><p>agg_fill_rast_match_points(), see details above function definition</p></li>
<li><p>use the point_values from agg_fill_rast_match_points() if not null</p></li>
<li><p>otherwise, use the point_values from crop_raster_match_points()</p></li>
</ul></li>
</ul><p>Note for development: currently looking at entire bounding box of points (or study boundary if defined) to fill NA raster cells
this is the most computationally intensive process, especially for large areas (&gt;100k ha), fine resolution rasters (&lt;=30m)
if the points are uniformly or randomly dispersed across the entire AOI, the current process is likely the best process
if the points are clustered in groups across the AOI, future development could attempt to group points into clusters
and iterate over the raster filling process for the cluster groups which may allow for finer resolution raster data as input (instead of aggregating)
see examples</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">crop_raster_match_points</span><span class="op">(</span></span>
<span>  <span class="va">points</span>,</span>
<span>  <span class="va">rast</span>,</span>
<span>  study_boundary <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  max_search_dist_m <span class="op">=</span> <span class="fl">1000</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-points">points<a class="anchor" aria-label="anchor" href="#arg-points"></a></dt>
<dd><p>sf.</p></dd>


<dt id="arg-rast">rast<a class="anchor" aria-label="anchor" href="#arg-rast"></a></dt>
<dd><p>SpatRaster.</p></dd>


<dt id="arg-study-boundary">study_boundary<a class="anchor" aria-label="anchor" href="#arg-study-boundary"></a></dt>
<dd><p>sf.</p></dd>


<dt id="arg-max-search-dist-m">max_search_dist_m<a class="anchor" aria-label="anchor" href="#arg-max-search-dist-m"></a></dt>
<dd><p>numeric.</p></dd>

</dl></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># !!!!!!!!!!!!!!!! this is a starter example for the author if decide to cluster points</span></span></span>
<span class="r-in"><span><span class="co"># !!!!!!!!!!!!!!!! and apply raster match, fill, aggregate separately for clusters</span></span></span>
<span class="r-in"><span><span class="co"># Sample data</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">7</span>, <span class="fl">8</span>, <span class="fl">9</span>, <span class="fl">10</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">7</span>, <span class="fl">8</span>, <span class="fl">9</span>, <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate distances</span></span></span>
<span class="r-in"><span><span class="va">distances</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Perform hierarchical clustering</span></span></span>
<span class="r-in"><span><span class="va">hc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html" class="external-link">hclust</a></span><span class="op">(</span><span class="va">distances</span>, method <span class="op">=</span> <span class="st">"complete"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate WSS for different numbers of clusters</span></span></span>
<span class="r-in"><span><span class="va">wss</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">for</span> <span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">wss</span><span class="op">[</span><span class="va">k</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html" class="external-link">kmeans</a></span><span class="op">(</span><span class="va">data</span>, centers <span class="op">=</span> <span class="va">k</span><span class="op">)</span><span class="op">$</span><span class="va">withinss</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot the elbow</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="va">wss</span>, type <span class="op">=</span> <span class="st">"b"</span>, xlab <span class="op">=</span> <span class="st">"Number of Clusters (k)"</span>,</span></span>
<span class="r-in"><span>     ylab <span class="op">=</span> <span class="st">"Within-Cluster Sum of Squares (WSS)"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Find the optimal number of clusters (this is subjective)</span></span></span>
<span class="r-in"><span><span class="co"># You might need to visually inspect the plot</span></span></span>
<span class="r-in"><span><span class="va">optimal_k</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">which.min</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">wss</span>, differences <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Cut the dendrogram based on the optimal number of clusters</span></span></span>
<span class="r-in"><span><span class="va">clusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cutree.html" class="external-link">cutree</a></span><span class="op">(</span><span class="va">hc</span>, k <span class="op">=</span> <span class="va">optimal_k</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by George Woolsey.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

