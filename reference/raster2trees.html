<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Use a CHM raster to detect individual trees — raster2trees • cloud2trees</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Use a CHM raster to detect individual trees — raster2trees"><meta name="description" content="raster2trees() is an all-in-one function to process a CHM raster
and return a spatial data frame of tree crown polygons and points.
The order of operations is:
Perform individual tree detection using lidR::locate_trees() with the lidR::lmf() algorithm
Delineate tree crowns using ForestTools::mcws()


Note, this function does not estimate DBH for the detected trees and only returns tree location, crown area, and height information.
To estimate tree DBH from the detected tree heights see trees_dbh()."><meta property="og:description" content="raster2trees() is an all-in-one function to process a CHM raster
and return a spatial data frame of tree crown polygons and points.
The order of operations is:
Perform individual tree detection using lidR::locate_trees() with the lidR::lmf() algorithm
Delineate tree crowns using ForestTools::mcws()


Note, this function does not estimate DBH for the detected trees and only returns tree location, crown area, and height information.
To estimate tree DBH from the detected tree heights see trees_dbh()."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">cloud2trees</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/cloud2trees-setup.html">Setup</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/cloud2trees-overview.html">Overview</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Tutorials</h6></li>
    <li><a class="dropdown-item" href="../articles/cloud2raster-tutorial.html">Creating DTM and CHM rasters</a></li>
    <li><a class="dropdown-item" href="../articles/raster2trees-tutorial.html">Generating a tree list from a CHM</a></li>
    <li><a class="dropdown-item" href="../articles/cloud2trees-pipeline.html">cloud2trees Pipeline</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/georgewoolsey/cloud2trees/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Use a CHM raster to detect individual trees</h1>
      <small class="dont-index">Source: <a href="https://github.com/georgewoolsey/cloud2trees/blob/main/R/raster2trees.R" class="external-link"><code>R/raster2trees.R</code></a></small>
      <div class="d-none name"><code>raster2trees.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>raster2trees()</code> is an all-in-one function to process a CHM raster
and return a spatial data frame of tree crown polygons and points.
The order of operations is:</p><ul><li><p>Perform individual tree detection using <code><a href="https://rdrr.io/pkg/lidR/man/locate_trees.html" class="external-link">lidR::locate_trees()</a></code> with the <code><a href="https://rdrr.io/pkg/lidR/man/itd_lmf.html" class="external-link">lidR::lmf()</a></code> algorithm</p></li>
<li><p>Delineate tree crowns using <code><a href="https://rdrr.io/pkg/ForestTools/man/mcws.html" class="external-link">ForestTools::mcws()</a></code></p></li>
</ul><p>Note, this function does not estimate DBH for the detected trees and only returns tree location, crown area, and height information.
To estimate tree DBH from the detected tree heights see <code><a href="trees_dbh.html">trees_dbh()</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">raster2trees</span><span class="op">(</span></span>
<span>  <span class="va">chm_rast</span>,</span>
<span>  <span class="va">outfolder</span>,</span>
<span>  ws <span class="op">=</span> <span class="fu"><a href="itd_ws_functions.html">itd_ws_functions</a></span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="st">"log_fn"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  min_height <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  min_crown_area <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  tempdir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-chm-rast">chm_rast<a class="anchor" aria-label="anchor" href="#arg-chm-rast"></a></dt>
<dd><p>raster. A  raster from <code>terra</code> or <code>stars</code>representing a canopy height model</p></dd>


<dt id="arg-outfolder">outfolder<a class="anchor" aria-label="anchor" href="#arg-outfolder"></a></dt>
<dd><p>string. The path of a folder to write the crown vector data to</p></dd>


<dt id="arg-ws">ws<a class="anchor" aria-label="anchor" href="#arg-ws"></a></dt>
<dd><p>numeric or function. Length or diameter of the moving window used to detect the local
maxima in the units of the input data (usually meters). If it is numeric a fixed window size is used.
If it is a function, the function determines the size of the window at any given location on the canopy.
By default function takes the height of a given pixel as its only argument and return the
desired size of the search window when centered on that pixel.</p></dd>


<dt id="arg-min-height">min_height<a class="anchor" aria-label="anchor" href="#arg-min-height"></a></dt>
<dd><p>numeric. Set the minimum height (m) for individual tree detection</p></dd>


<dt id="arg-min-crown-area">min_crown_area<a class="anchor" aria-label="anchor" href="#arg-min-crown-area"></a></dt>
<dd><p>numeric. Set the minimum crown area (m2) for individual tree detection</p></dd>


<dt id="arg-tempdir">tempdir<a class="anchor" aria-label="anchor" href="#arg-tempdir"></a></dt>
<dd><p>string. Directory to write intermediate files. Intermediate files are only created for large rasters too big to fit in memory.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Returns a spatial data frame of individual tree crown vectors detected using the CHM.
The tree top point coordinates are located in the <code>tree_x</code> and <code>tree_y</code> columns.
The process also writes two <code>.gpkg</code> files to the <code>outfolder</code> directory: <code>chm_detected_crowns.gpkg</code> and <code>chm_detected_tree_tops.gpkg</code></p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p><a href="https://r-lidar.github.io/lidRbook/itd.html" class="external-link">https://r-lidar.github.io/lidRbook/itd.html</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span> <span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span> <span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"cloud2trees"</span><span class="op">)</span>,<span class="st">"/extdata/chm.tif"</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="va">crowns_sf</span> <span class="op">&lt;-</span> <span class="fu">raster2trees</span><span class="op">(</span>chm_rast <span class="op">=</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span>, outfolder <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="va">crowns_sf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="va">crowns_sf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="va">crowns_sf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">tree_height_m</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by George Woolsey.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

