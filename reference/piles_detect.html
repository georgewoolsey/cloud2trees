<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Geometric rules-based detection of slash piles from CHM data — piles_detect • cloud2trees</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Geometric rules-based detection of slash piles from CHM data — piles_detect"><meta name="description" content="This function implements a geometric, rules-based framework to
identify candidate slash piles from a Canopy Height Model (CHM). The process
begins by defining a vertical search space within the CHM
based on user-defined height thresholds. Once candidate segments
are generated via the chosen segmentation method, the function applies two
distinct shape irregularity filters to refine the results. This approach
ensures that the final predictions align with the expected structural
characteristics of slash piles that also meet expected sizing thresholds
based on minimum and maximum area expectations set by the user.
Users should determine these threshold values based on pile
construction prescriptions, on-site
visual observations post-treatment, or prior research on typical pile
dimensions for the specific treatment/forest type. This function is the primary
structural pile detection process and is intended to be used prior to
piles_spectral_filter() for a complete detection workflow."><meta property="og:description" content="This function implements a geometric, rules-based framework to
identify candidate slash piles from a Canopy Height Model (CHM). The process
begins by defining a vertical search space within the CHM
based on user-defined height thresholds. Once candidate segments
are generated via the chosen segmentation method, the function applies two
distinct shape irregularity filters to refine the results. This approach
ensures that the final predictions align with the expected structural
characteristics of slash piles that also meet expected sizing thresholds
based on minimum and maximum area expectations set by the user.
Users should determine these threshold values based on pile
construction prescriptions, on-site
visual observations post-treatment, or prior research on typical pile
dimensions for the specific treatment/forest type. This function is the primary
structural pile detection process and is intended to be used prior to
piles_spectral_filter() for a complete detection workflow."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">cloud2trees</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.8</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/cloud2trees-setup.html">Setup</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/cloud2trees-overview.html">Overview</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Tutorials</h6></li>
    <li><a class="dropdown-item" href="../articles/cloud2raster-tutorial.html">Creating DTM and CHM rasters</a></li>
    <li><a class="dropdown-item" href="../articles/raster2trees-tutorial.html">Generating a tree list from a CHM</a></li>
    <li><a class="dropdown-item" href="../articles/cloud2trees-pipeline.html">cloud2trees Pipeline</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/georgewoolsey/cloud2trees/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Geometric rules-based detection of slash piles from CHM data</h1>
      <small class="dont-index">Source: <a href="https://github.com/georgewoolsey/cloud2trees/blob/main/R/piles_detect.R" class="external-link"><code>R/piles_detect.R</code></a></small>
      <div class="d-none name"><code>piles_detect.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function implements a geometric, rules-based framework to
identify candidate slash piles from a Canopy Height Model (CHM). The process
begins by defining a vertical search space within the CHM
based on user-defined height thresholds. Once candidate segments
are generated via the chosen segmentation method, the function applies two
distinct shape irregularity filters to refine the results. This approach
ensures that the final predictions align with the expected structural
characteristics of slash piles that also meet expected sizing thresholds
based on minimum and maximum area expectations set by the user.
Users should determine these threshold values based on pile
construction prescriptions, on-site
visual observations post-treatment, or prior research on typical pile
dimensions for the specific treatment/forest type. This function is the primary
structural pile detection process and is intended to be used prior to
<code><a href="piles_spectral_filter.html">piles_spectral_filter()</a></code> for a complete detection workflow.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">piles_detect</span><span class="op">(</span></span>
<span>  <span class="va">chm_rast</span>,</span>
<span>  seg_method <span class="op">=</span> <span class="st">"dbscan"</span>,</span>
<span>  <span class="va">min_ht_m</span>,</span>
<span>  <span class="va">max_ht_m</span>,</span>
<span>  <span class="va">min_area_m2</span>,</span>
<span>  <span class="va">max_area_m2</span>,</span>
<span>  <span class="va">min_convexity_ratio</span>,</span>
<span>  <span class="va">min_circularity_ratio</span>,</span>
<span>  smooth_segs <span class="op">=</span> <span class="cn">T</span>,</span>
<span>  outfile <span class="op">=</span> <span class="cn">NA</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-chm-rast">chm_rast<a class="anchor" aria-label="anchor" href="#arg-chm-rast"></a></dt>
<dd><p>A SpatRaster object representing the Canopy Height Model.</p></dd>


<dt id="arg-seg-method">seg_method<a class="anchor" aria-label="anchor" href="#arg-seg-method"></a></dt>
<dd><p>Character string. The segmentation algorithm to use:
either "watershed" or "dbscan".</p></dd>


<dt id="arg-min-ht-m">min_ht_m<a class="anchor" aria-label="anchor" href="#arg-min-ht-m"></a></dt>
<dd><p>Numeric. The minimum expected pile height.</p></dd>


<dt id="arg-max-ht-m">max_ht_m<a class="anchor" aria-label="anchor" href="#arg-max-ht-m"></a></dt>
<dd><p>Numeric. The upper limit of the vertical search space and expected pile height.</p></dd>


<dt id="arg-min-area-m-">min_area_m2<a class="anchor" aria-label="anchor" href="#arg-min-area-m-"></a></dt>
<dd><p>Numeric. The minimum pile footprint area required for a
segment to be retained as a candidate.</p></dd>


<dt id="arg-max-area-m-">max_area_m2<a class="anchor" aria-label="anchor" href="#arg-max-area-m-"></a></dt>
<dd><p>Numeric. The maximum pile footprint area expected.</p></dd>


<dt id="arg-min-convexity-ratio">min_convexity_ratio<a class="anchor" aria-label="anchor" href="#arg-min-convexity-ratio"></a></dt>
<dd><p>Numeric (0 to 1). Also known as the "solidity"
ratio. Calculated as (Area of Polygon / Area of Convex Hull). This metric
identifies segments with deep indents, holes, or branching. A perfectly
convex shape like a circle or square has a ratio of 1.0. Values closer to
0 indicate high irregularity or concavity. Note that convexity is not
sensitive to elongation.</p></dd>


<dt id="arg-min-circularity-ratio">min_circularity_ratio<a class="anchor" aria-label="anchor" href="#arg-min-circularity-ratio"></a></dt>
<dd><p>Numeric (0 to 1). Also known as the "Reock
Compactness Score." Calculated as (Area of Polygon / Area of Minimum
Bounding Circle). This measures how closely a shape is spread around its
central point. A perfect circle has a ratio of 1.0. For reference, a
perfect square is approximately 0.637 and an equilateral triangle is
approximately 0.414.</p></dd>


<dt id="arg-smooth-segs">smooth_segs<a class="anchor" aria-label="anchor" href="#arg-smooth-segs"></a></dt>
<dd><p>Logical. Should convex hull smoothing be applied to the
raster-detected segment boundaries to reduce pixelated edges?
Any resulting smoothed segments that overlap are removed based since
slash piles are generally distinct objects on the landscape.</p></dd>


<dt id="arg-outfile">outfile<a class="anchor" aria-label="anchor" href="#arg-outfile"></a></dt>
<dd><p>Character string or NA. If NA (default), the function
returns the segmented piles as an <code>sf</code> object. If a valid file path is
provided (e.g., "./output/detected_piles.gpkg"), the result is written
to a GeoPackage file and the function returns the character string of the
file path.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>If <code>outfile</code> is NA, returns an <code>sf</code> object of candidate pile polygons.
If <code>outfile</code> is a character string, returns the character string of the
saved file path.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span> <span class="co">###########################################</span></span></span>
<span class="r-in"><span> <span class="co"># piles_detect() test</span></span></span>
<span class="r-in"><span> <span class="co">###########################################</span></span></span>
<span class="r-in"><span> <span class="co"># load a chm</span></span></span>
<span class="r-in"><span> <span class="va">chm_fnm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"cloud2trees"</span>, <span class="st">"extdata"</span>, <span class="st">"piles_chm.tif"</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="va">my_chm</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">chm_fnm</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">my_chm</span>, axes <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="co"># piles_detect() that</span></span></span>
<span class="r-in"><span> <span class="va">piles_detect_ans</span> <span class="op">&lt;-</span> <span class="fu">piles_detect</span><span class="op">(</span></span></span>
<span class="r-in"><span>   chm_rast <span class="op">=</span> <span class="va">my_chm</span></span></span>
<span class="r-in"><span>   , seg_method <span class="op">=</span> <span class="st">"dbscan"</span></span></span>
<span class="r-in"><span>   , min_ht_m <span class="op">=</span> <span class="fl">1</span></span></span>
<span class="r-in"><span>   , max_ht_m <span class="op">=</span> <span class="fl">4</span></span></span>
<span class="r-in"><span>   , min_area_m2 <span class="op">=</span> <span class="va">pi</span><span class="op">*</span><span class="op">(</span><span class="fl">1.5</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span></span>
<span class="r-in"><span>   , max_area_m2 <span class="op">=</span> <span class="va">pi</span><span class="op">*</span><span class="op">(</span><span class="fl">6</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span></span>
<span class="r-in"><span>   , min_convexity_ratio <span class="op">=</span> <span class="fl">0.3</span></span></span>
<span class="r-in"><span>   , min_circularity_ratio <span class="op">=</span> <span class="fl">0.4</span></span></span>
<span class="r-in"><span>   , smooth_segs <span class="op">=</span> <span class="cn">T</span></span></span>
<span class="r-in"><span>   , outfile <span class="op">=</span> <span class="cn">NA</span></span></span>
<span class="r-in"><span> <span class="op">)</span></span></span>
<span class="r-in"><span> <span class="co"># what?</span></span></span>
<span class="r-in"><span> <span class="va">piles_detect_ans</span></span></span>
<span class="r-in"><span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">piles_detect_ans</span><span class="op">$</span><span class="va">segs_sf</span><span class="op">)</span> <span class="co"># here are pile polygons</span></span></span>
<span class="r-in"><span> <span class="co"># plot on orig chm</span></span></span>
<span class="r-in"><span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">my_chm</span>, axes <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="va">piles_detect_ans</span><span class="op">$</span><span class="va">segs_sf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>   <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>   <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span>border <span class="op">=</span> <span class="st">"magenta"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="cn">NA</span>, add <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="co"># plot on chm slice generated by piles_detect()</span></span></span>
<span class="r-in"><span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">piles_detect_ans</span><span class="op">$</span><span class="va">slice_chm_rast</span>, axes <span class="op">=</span> <span class="cn">F</span>, col <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">cividis</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="va">piles_detect_ans</span><span class="op">$</span><span class="va">segs_sf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>   <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>   <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span>border <span class="op">=</span> <span class="st">"magenta"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="cn">NA</span>, add <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="co"># what if we use the `outfile` arg in piles_detect() ?</span></span></span>
<span class="r-in"><span> <span class="va">my_fnm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="va">piles_detect_ans2</span> <span class="op">&lt;-</span> <span class="fu">piles_detect</span><span class="op">(</span></span></span>
<span class="r-in"><span>   chm_rast <span class="op">=</span> <span class="va">my_chm</span></span></span>
<span class="r-in"><span>   , seg_method <span class="op">=</span> <span class="st">"dbscan"</span></span></span>
<span class="r-in"><span>   , min_ht_m <span class="op">=</span> <span class="fl">1</span></span></span>
<span class="r-in"><span>   , max_ht_m <span class="op">=</span> <span class="fl">6.6</span></span></span>
<span class="r-in"><span>   , min_area_m2 <span class="op">=</span> <span class="va">pi</span><span class="op">*</span><span class="op">(</span><span class="fl">1.5</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span></span>
<span class="r-in"><span>   , max_area_m2 <span class="op">=</span> <span class="va">pi</span><span class="op">*</span><span class="op">(</span><span class="fl">8</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span></span>
<span class="r-in"><span>   , min_convexity_ratio <span class="op">=</span> <span class="fl">0.11</span></span></span>
<span class="r-in"><span>   , min_circularity_ratio <span class="op">=</span> <span class="fl">0.22</span></span></span>
<span class="r-in"><span>   , smooth_segs <span class="op">=</span> <span class="cn">T</span></span></span>
<span class="r-in"><span>   , outfile <span class="op">=</span> <span class="va">my_fnm</span></span></span>
<span class="r-in"><span> <span class="op">)</span></span></span>
<span class="r-in"><span> <span class="va">piles_detect_ans2</span> <span class="co"># this is now a filename</span></span></span>
<span class="r-in"><span> <span class="va">piles</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">piles_detect_ans2</span><span class="op">)</span> <span class="co"># read it</span></span></span>
<span class="r-in"><span> <span class="co"># plot on orig chm</span></span></span>
<span class="r-in"><span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">my_chm</span>, axes <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="va">piles</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>   <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>   <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span>border <span class="op">=</span> <span class="st">"magenta"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="cn">NA</span>, add <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by George Woolsey.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

