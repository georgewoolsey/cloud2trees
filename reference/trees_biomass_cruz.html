<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Estimate tree crown biomass for a tree list based on Cruz et al. (2003) — trees_biomass_cruz • cloud2trees</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimate tree crown biomass for a tree list based on Cruz et al. (2003) — trees_biomass_cruz"><meta name="description" content="trees_biomass_cruz() uses the input tree list (e.g. as exported by raster2trees()) with the columns
treeID, tree_x, tree_y to attempt to attach tree crown biomass in kilogram estimates based on
the Cruz et al. (2003) equations (see references) and the FIA forest type group.
If a spatial data frame of points is the input tree list, then the columns tree_x, tree_y are not required.
If the FIA forest type group data named forest_type_group_codeis not in the input tree list, then the function calls
trees_type() to attempt to attach the FIA forest type group.
Other required columns include:
crown_area_m2, tree_height_m (e.g. as exported by raster2trees())
tree_cbh_m (e.g. as exported by trees_cbh())
and one of dbh_cm, dbh_m, or  basal_area_m2 (e.g. as exported by trees_dbh())


The Cruz et al. (2003) study developed models to predict canopy fuel stratum at the
stand level for four coniferous forest types common in the western US:
Douglas-fir, ponderosa pine, lodgepole pine, and mixed conifer.
Models for other forests types are currently lacking which limits the scope of this methodology.
If the tree list has trees that are in a FIA forest type group not represented in the list above,
then the return data will be blank
Canopy Bulk Density is mass of flammable material per unit volume of the tree
crown typically expressed in units of mass per unit volume (e.g., kilograms per cubic meter).
The process for estimating tree crown biomass in kilograms is:
Nearest neighbor imputation is used to fill the FIA forest type data if a tree falls inside a non-forest cell in the original data
The LANDFIRE estimate of CBD is distributed across the individual trees that fall in a raster cell by:
At the stand level (i.e. raster cell), aggregate the tree level data within the stand to obtain:


mean_crown_length_m = mean(crown_length_m), where tree crown_length_m = tree_height_m - tree_cbh_m
sum_crown_volume_m3 = sum(crown_volume_m3), where tree crown_volume_m3 = (4/3) * pi * ((crown_length_m/2)) * ((crown_dia_m/2)^2)


At the stand level (i.e. raster cell), determine the area of the stand that overlaps (overlap_area_m2) with the AOI defined as the study_boundary parameter (see below) or the bounding box of all the trees
At the stand level (i.e. raster cell), use the Cruz equations (Table 4; see reference) to estimate of CBD in kilograms per cubic meter (cruz_stand_kg_per_m3)
At the stand level (i.e. raster cell), get canopy fuel loading (CFL) in kilograms per square meter (kg_per_m2 = mean_crown_length_m * cruz_stand_kg_per_m3)
At the stand level (i.e. raster cell), get the stand biomass in kilograms (biomass_kg = kg_per_m2 * overlap_area_m2)
At the stand level (i.e. raster cell), the single tree CBD in kilograms per cubic meter will be a constant (cruz_tree_kg_per_m3 = biomass_kg / sum_crown_volume_m3)
Attach the the single tree CBD in kilograms per cubic meter to the tree level based on raster cell spatial overlap
Calculate individual tree crown mass in kilograms as cruz_crown_biomass_kg = cruz_tree_kg_per_m3 * crown_volume_m3


"><meta property="og:description" content="trees_biomass_cruz() uses the input tree list (e.g. as exported by raster2trees()) with the columns
treeID, tree_x, tree_y to attempt to attach tree crown biomass in kilogram estimates based on
the Cruz et al. (2003) equations (see references) and the FIA forest type group.
If a spatial data frame of points is the input tree list, then the columns tree_x, tree_y are not required.
If the FIA forest type group data named forest_type_group_codeis not in the input tree list, then the function calls
trees_type() to attempt to attach the FIA forest type group.
Other required columns include:
crown_area_m2, tree_height_m (e.g. as exported by raster2trees())
tree_cbh_m (e.g. as exported by trees_cbh())
and one of dbh_cm, dbh_m, or  basal_area_m2 (e.g. as exported by trees_dbh())


The Cruz et al. (2003) study developed models to predict canopy fuel stratum at the
stand level for four coniferous forest types common in the western US:
Douglas-fir, ponderosa pine, lodgepole pine, and mixed conifer.
Models for other forests types are currently lacking which limits the scope of this methodology.
If the tree list has trees that are in a FIA forest type group not represented in the list above,
then the return data will be blank
Canopy Bulk Density is mass of flammable material per unit volume of the tree
crown typically expressed in units of mass per unit volume (e.g., kilograms per cubic meter).
The process for estimating tree crown biomass in kilograms is:
Nearest neighbor imputation is used to fill the FIA forest type data if a tree falls inside a non-forest cell in the original data
The LANDFIRE estimate of CBD is distributed across the individual trees that fall in a raster cell by:
At the stand level (i.e. raster cell), aggregate the tree level data within the stand to obtain:


mean_crown_length_m = mean(crown_length_m), where tree crown_length_m = tree_height_m - tree_cbh_m
sum_crown_volume_m3 = sum(crown_volume_m3), where tree crown_volume_m3 = (4/3) * pi * ((crown_length_m/2)) * ((crown_dia_m/2)^2)


At the stand level (i.e. raster cell), determine the area of the stand that overlaps (overlap_area_m2) with the AOI defined as the study_boundary parameter (see below) or the bounding box of all the trees
At the stand level (i.e. raster cell), use the Cruz equations (Table 4; see reference) to estimate of CBD in kilograms per cubic meter (cruz_stand_kg_per_m3)
At the stand level (i.e. raster cell), get canopy fuel loading (CFL) in kilograms per square meter (kg_per_m2 = mean_crown_length_m * cruz_stand_kg_per_m3)
At the stand level (i.e. raster cell), get the stand biomass in kilograms (biomass_kg = kg_per_m2 * overlap_area_m2)
At the stand level (i.e. raster cell), the single tree CBD in kilograms per cubic meter will be a constant (cruz_tree_kg_per_m3 = biomass_kg / sum_crown_volume_m3)
Attach the the single tree CBD in kilograms per cubic meter to the tree level based on raster cell spatial overlap
Calculate individual tree crown mass in kilograms as cruz_crown_biomass_kg = cruz_tree_kg_per_m3 * crown_volume_m3


"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">cloud2trees</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/cloud2trees-setup.html">Setup</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/cloud2trees-overview.html">Overview</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Tutorials</h6></li>
    <li><a class="dropdown-item" href="../articles/cloud2raster-tutorial.html">Creating DTM and CHM rasters</a></li>
    <li><a class="dropdown-item" href="../articles/raster2trees-tutorial.html">Generating a tree list from a CHM</a></li>
    <li><a class="dropdown-item" href="../articles/cloud2trees-pipeline.html">cloud2trees Pipeline</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/georgewoolsey/cloud2trees/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Estimate tree crown biomass for a tree list based on Cruz et al. (2003)</h1>
      <small class="dont-index">Source: <a href="https://github.com/georgewoolsey/cloud2trees/blob/main/R/trees_biomass_cruz.R" class="external-link"><code>R/trees_biomass_cruz.R</code></a></small>
      <div class="d-none name"><code>trees_biomass_cruz.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>trees_biomass_cruz()</code> uses the input tree list (e.g. as exported by <code><a href="raster2trees.html">raster2trees()</a></code>) with the columns
<code>treeID</code>, <code>tree_x</code>, <code>tree_y</code> to attempt to attach tree crown biomass in kilogram estimates based on
the Cruz et al. (2003) equations (see references) and the FIA forest type group.</p>
<p>If a spatial data frame of points is the input tree list, then the columns <code>tree_x</code>, <code>tree_y</code> are not required.
If the FIA forest type group data named <code>forest_type_group_code</code>is not in the input tree list, then the function calls
<code><a href="trees_type.html">trees_type()</a></code> to attempt to attach the FIA forest type group.
Other required columns include:</p><ul><li><p><code>crown_area_m2</code>, <code>tree_height_m</code> (e.g. as exported by <code><a href="raster2trees.html">raster2trees()</a></code>)</p></li>
<li><p><code>tree_cbh_m</code> (e.g. as exported by <code><a href="trees_cbh.html">trees_cbh()</a></code>)</p></li>
<li><p>and one of <code>dbh_cm</code>, <code>dbh_m</code>, or  <code>basal_area_m2</code> (e.g. as exported by <code><a href="trees_dbh.html">trees_dbh()</a></code>)</p></li>
</ul><p>The Cruz et al. (2003) study developed models to predict canopy fuel stratum at the
stand level for four coniferous forest types common in the western US:
Douglas-fir, ponderosa pine, lodgepole pine, and mixed conifer.
Models for other forests types are currently lacking which limits the scope of this methodology.
If the tree list has trees that are in a FIA forest type group not represented in the list above,
then the return data will be blank</p>
<p>Canopy Bulk Density is mass of flammable material per unit volume of the tree
crown typically expressed in units of mass per unit volume (e.g., kilograms per cubic meter).</p>
<p>The process for estimating tree crown biomass in kilograms is:</p><ul><li><p>Nearest neighbor imputation is used to fill the FIA forest type data if a tree falls inside a non-forest cell in the original data</p></li>
<li><p>The LANDFIRE estimate of CBD is distributed across the individual trees that fall in a raster cell by:</p><ol><li><p>At the stand level (i.e. raster cell), aggregate the tree level data within the stand to obtain:</p></li>
</ol><ul><li><p><code>mean_crown_length_m = mean(crown_length_m)</code>, where tree <code>crown_length_m = tree_height_m - tree_cbh_m</code></p></li>
<li><p><code>sum_crown_volume_m3 = sum(crown_volume_m3)</code>, where tree <code>crown_volume_m3 = (4/3) * pi * ((crown_length_m/2)) * ((crown_dia_m/2)^2)</code></p></li>
</ul><ol><li><p>At the stand level (i.e. raster cell), determine the area of the stand that overlaps (<code>overlap_area_m2</code>) with the AOI defined as the <code>study_boundary</code> parameter (see below) or the bounding box of all the trees</p></li>
<li><p>At the stand level (i.e. raster cell), use the Cruz equations (Table 4; see reference) to estimate of CBD in kilograms per cubic meter (<code>cruz_stand_kg_per_m3</code>)</p></li>
<li><p>At the stand level (i.e. raster cell), get canopy fuel loading (CFL) in kilograms per square meter (<code>kg_per_m2 = mean_crown_length_m * cruz_stand_kg_per_m3</code>)</p></li>
<li><p>At the stand level (i.e. raster cell), get the stand biomass in kilograms (<code>biomass_kg = kg_per_m2 * overlap_area_m2</code>)</p></li>
<li><p>At the stand level (i.e. raster cell), the single tree CBD in kilograms per cubic meter will be a constant (<code>cruz_tree_kg_per_m3 = biomass_kg / sum_crown_volume_m3</code>)</p></li>
<li><p>Attach the the single tree CBD in kilograms per cubic meter to the tree level based on raster cell spatial overlap</p></li>
<li><p>Calculate individual tree crown mass in kilograms as <code>cruz_crown_biomass_kg = cruz_tree_kg_per_m3 * crown_volume_m3</code></p></li>
</ol></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">trees_biomass_cruz</span><span class="op">(</span></span>
<span>  <span class="va">tree_list</span>,</span>
<span>  crs <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  study_boundary <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  input_foresttype_dir <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  max_crown_kg_per_m3 <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-tree-list">tree_list<a class="anchor" aria-label="anchor" href="#arg-tree-list"></a></dt>
<dd><p>data.frame. A data frame with the columns <code>treeID</code>, <code>tree_x</code>, and <code>tree_y</code>.
If an <code>sf</code> class object with POINT geometry (see <code><a href="https://r-spatial.github.io/sf/reference/st_geometry_type.html" class="external-link">sf::st_geometry_type()</a></code>), the program will use the data "as-is" and only require the <code>treeID</code> column.
Other required columns include:</p><ul><li><p><code>crown_area_m2</code>, <code>tree_height_m</code> (e.g. as exported by <code><a href="raster2trees.html">raster2trees()</a></code>)</p></li>
<li><p><code>tree_cbh_m</code> (e.g. as exported by <code><a href="trees_cbh.html">trees_cbh()</a></code>)</p></li>
<li><p>and one of <code>dbh_cm</code>, <code>dbh_m</code>, or  <code>basal_area_m2</code> (e.g. as exported by <code><a href="trees_dbh.html">trees_dbh()</a></code>)</p></li>
</ul></dd>


<dt id="arg-crs">crs<a class="anchor" aria-label="anchor" href="#arg-crs"></a></dt>
<dd><p>string. A crs string as returned from <code><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">sf::st_crs()</a></code> or the EPSG code of the x,y coordinates.
Defaults to the crs of the <code>tree_list</code> data if of class "sf".</p></dd>


<dt id="arg-study-boundary">study_boundary<a class="anchor" aria-label="anchor" href="#arg-study-boundary"></a></dt>
<dd><p>sf. The boundary of the study area to define the area of interest which may extend beyond the space with trees.
If no boundary given, the AOI will be built from location of trees in the tree list.</p></dd>


<dt id="arg-input-foresttype-dir">input_foresttype_dir<a class="anchor" aria-label="anchor" href="#arg-input-foresttype-dir"></a></dt>
<dd><p>directory where Forest Type Groups data exists. Use <code><a href="get_foresttype.html">get_foresttype()</a></code> first.</p></dd>


<dt id="arg-max-crown-kg-per-m-">max_crown_kg_per_m3<a class="anchor" aria-label="anchor" href="#arg-max-crown-kg-per-m-"></a></dt>
<dd><p>numeric. the maximum CBD of the tree crown in kilograms per cubic meter.
Values above this limit will be set at the median value for the area using only stands that have CBD values lower than this limit.
The default value of 2 kilograms per cubic meter was based on <a href="https://doi.org/10.1016/j.combustflame.2009.06.015" class="external-link">Mell et al. (2009)</a>
who found the dry bulk density of the tree crown was 2.6 kilograms per cubed meter
using Douglas-fir trees grown on Christmas tree farms.
Set this parameter to a large value (e.g. 1e10) or NULL to avoid limiting tree crown CBD.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Returns a list of objects: tree_list = spatial data frame of individual trees
; stand_cell_data = data frame of stands/cells in same projection as the FIA forest type group raster data</p>
<p>See code in examples.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>

<ul><li><p><a href="https://www.arcgis.com/home/item.html?id=10760c83b9e44923bd3c18efdaa7319d" class="external-link">Forest Type Groups of the Continental United States</a>
Wilson, B.T. (2023). Forest Type Groups of the Continental United States.</p></li>
<li><p><a href="https://scholar.google.com/scholar?cluster=316241498622221569&amp;oi=gsb&amp;hl=en&amp;as_sdt=0,5" class="external-link">doi:10.1071/WF02024</a>
Cruz, M.G, M.E. Alexander, and R.H. Wakimoto. 2003. Assessing canopy fuel stratum characteristics in crown fire prone fuel types of western North America. Int. J. Wildland Fire. 12(1):39-50.</p></li>
<li><p><a href="https://doi.org/10.1016/j.combustflame.2009.06.015" class="external-link">https://doi.org/10.1016/j.combustflame.2009.06.015</a>
Mell, W., Maranghides, A., McDermott, R., &amp; Manzello, S. L. (2009). Numerical simulation and experiments of burning douglas fir trees. Combustion and Flame, 156(10), 2023-2041.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span> <span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">my_n</span> <span class="op">&lt;-</span> <span class="fl">111</span></span></span>
<span class="r-in"><span><span class="co"># fake tree list</span></span></span>
<span class="r-in"><span><span class="va">tl</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    treeID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">my_n</span><span class="op">)</span></span></span>
<span class="r-in"><span>    , tree_x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="va">my_n</span>, mean <span class="op">=</span> <span class="fl">458064</span>, sd <span class="op">=</span> <span class="fl">33</span><span class="op">)</span></span></span>
<span class="r-in"><span>    , tree_y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="va">my_n</span>, mean <span class="op">=</span> <span class="fl">4450074</span>, sd <span class="op">=</span> <span class="fl">33</span><span class="op">)</span></span></span>
<span class="r-in"><span>    , tree_height_m <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="va">my_n</span>, mean <span class="op">=</span> <span class="fl">10</span>, sd <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    tree_height_m <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">tree_height_m</span><span class="op">&lt;</span><span class="fl">1.37</span>, <span class="fl">1.37</span>, <span class="va">tree_height_m</span><span class="op">)</span> <span class="co"># above DBH</span></span></span>
<span class="r-in"><span>    , crown_area_m2 <span class="op">=</span> <span class="fl">0.47</span><span class="op">+</span><span class="op">(</span><span class="fl">0.49</span><span class="op">*</span><span class="va">tree_height_m</span><span class="op">)</span></span></span>
<span class="r-in"><span>    , tree_cbh_m <span class="op">=</span> <span class="fl">0.72</span><span class="op">+</span><span class="op">(</span><span class="fl">0.53</span><span class="op">*</span><span class="va">tree_height_m</span><span class="op">)</span></span></span>
<span class="r-in"><span>    , dbh_cm <span class="op">=</span> <span class="op">-</span><span class="fl">2.3</span><span class="op">+</span><span class="op">(</span><span class="fl">2.14</span><span class="op">*</span><span class="va">tree_height_m</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># how does our fake tree list look?</span></span></span>
<span class="r-in"><span><span class="va">tl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dbh_cm</span>, y <span class="op">=</span> <span class="va">tree_height_m</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># call the function</span></span></span>
<span class="r-in"><span><span class="va">tl_cruz</span> <span class="op">&lt;-</span> <span class="fu">trees_biomass_cruz</span><span class="op">(</span>tree_list <span class="op">=</span> <span class="va">tl</span>, crs <span class="op">=</span> <span class="st">"32613"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># what is in it?</span></span></span>
<span class="r-in"><span><span class="va">tl_cruz</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># look at the trees</span></span></span>
<span class="r-in"><span><span class="va">tl_cruz</span><span class="op">$</span><span class="va">tree_list</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># tree FIA forest type groups</span></span></span>
<span class="r-in"><span><span class="va">tl_cruz</span><span class="op">$</span><span class="va">tree_list</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">forest_type_group_code</span>, <span class="va">forest_type_group</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># look at the stand</span></span></span>
<span class="r-in"><span><span class="va">tl_cruz</span><span class="op">$</span><span class="va">stand_cell_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">trees</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># get the projection for the stand cell data</span></span></span>
<span class="r-in"><span><span class="va">epsg_code</span> <span class="op">&lt;-</span> <span class="va">tl_cruz</span><span class="op">$</span><span class="va">stand_cell_data</span><span class="op">$</span><span class="va">rast_epsg_code</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="co"># plot the stand cell data with trees overlaid</span></span></span>
<span class="r-in"><span> <span class="va">tl_cruz</span><span class="op">$</span><span class="va">stand_cell_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>   <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>   <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>,y<span class="op">=</span><span class="va">y</span>,fill <span class="op">=</span> <span class="va">cruz_stand_kg_per_m3</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"gray44"</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>   <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>,y<span class="op">=</span><span class="va">y</span>,label <span class="op">=</span> <span class="va">trees</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>   <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>     data <span class="op">=</span> <span class="va">tl_cruz</span><span class="op">$</span><span class="va">tree_list</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="va">epsg_code</span><span class="op">)</span></span></span>
<span class="r-in"><span>     , <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">cruz_crown_biomass_kg</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>   <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"stand kg/m3"</span>, color <span class="op">=</span> <span class="st">"tree crown kg"</span>, caption <span class="op">=</span> <span class="st">"# trees shown in cell"</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>   <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"rocket"</span>, na.value <span class="op">=</span> <span class="st">"gray"</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>   <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"viridis"</span>, na.value <span class="op">=</span> <span class="st">"gray22"</span>, begin <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>   <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by George Woolsey.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

