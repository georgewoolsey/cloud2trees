<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Aerial point cloud data to forest inventory tree lists • cloud2trees</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Aerial point cloud data to forest inventory tree lists">
<meta name="description" content="Extract a tree list, CHM, DTM, and more from .las|.laz point cloud data. Point cloud data can be from a LiDAR sensor or photogrammetry (i.e. structure from motion).">
<meta property="og:description" content="Extract a tree list, CHM, DTM, and more from .las|.laz point cloud data. Point cloud data can be from a LiDAR sensor or photogrammetry (i.e. structure from motion).">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">cloud2trees</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="articles/cloud2trees-setup.html">Setup</a></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/cloud2trees-overview.html">Overview</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Tutorials</h6></li>
    <li><a class="dropdown-item" href="articles/cloud2raster-tutorial.html">Creating DTM and CHM rasters</a></li>
    <li><a class="dropdown-item" href="articles/raster2trees-tutorial.html">Generating a tree list from a CHM</a></li>
    <li><a class="dropdown-item" href="articles/cloud2trees-pipeline.html">cloud2trees Pipeline</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/georgewoolsey/cloud2trees/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="cloud2trees">cloud2trees<a class="anchor" aria-label="anchor" href="#cloud2trees"></a>
</h1></div>
<ul>
<li><a href="#cloud2trees-aerial-point-cloud-data-to-forest-inventory-tree-lists">cloud2trees: Aerial point cloud data to forest inventory tree lists</a></li>
<li><a href="#installation-and-setup">Installation and Setup</a></li>
<li><a href="#extract-trees-from-point-cloud-default">Extract Trees from Point Cloud: Default</a></li>
<li><a href="#individual-tree-detection-itd-tuning">Individual Tree Detection (ITD) Tuning</a></li>
<li><a href="#extract-trees-from-point-cloud-custom">Extract Trees from Point Cloud: Custom</a></li>
<li><a href="#format-cloud2trees-output-for-lanl-trees">Format <code>cloud2trees()</code> output for LANL TREES</a></li>
<li><a href="#extract-raster-data-from-point-cloud">Extract Raster Data from Point Cloud</a></li>
<li><a href="#extract-trees-from-raster-data">Extract Trees from Raster Data</a></li>
<li><a href="#estimate-tree-dbh-for-a-tree-list">Estimate Tree DBH for a Tree List</a></li>
<li><a href="#estimate-tree-forest-type-for-a-tree-list">Estimate Tree Forest Type for a Tree List</a></li>
<li><a href="#estimate-tree-cbh-for-a-tree-list">Estimate Tree CBH for a Tree List</a></li>
<li><a href="#estimate-tree-hmd-for-a-tree-list">Estimate Tree HMD for a Tree List</a></li>
<li><a href="#estimate-tree-biomass-for-a-tree-list">Estimate Tree Biomass for a Tree List</a></li>
</ul>
<!-- README.md is generated from README.Rmd. Please edit that file --><!-- badges: start --><!-- badges: end --><p><img src="reference/figures/Graphical_Abstract.jpg" alt="cloud2trees graphical abstract"></p>
</div>
<div class="section level1">
<h1 id="cloud2trees-aerial-point-cloud-data-to-forest-inventory-tree-lists">cloud2trees: Aerial point cloud data to forest inventory tree lists<a class="anchor" aria-label="anchor" href="#cloud2trees-aerial-point-cloud-data-to-forest-inventory-tree-lists"></a>
</h1>
<p>The goal of cloud2trees is to provide accessible routines for processing point cloud data collected by airborne lidar or developed using UAS imagery and photogrammetry (e.g. structure from motion). The cloud2trees package implements some of the methods outlined in the literature below. Some of the methodologies implemented in the cloud2trees package have been developed specifically to quantify <em>conifer</em> forest structure and may not be appropriate for other uses.</p>
<ul>
<li>Swayze, Neal C., and Wade T. Tinkham. <a href="https://scholar.google.com/scholar?oi=bibs&amp;hl=en&amp;cluster=10655866445299954513" class="external-link">“Application of unmanned aerial system structure from motion point cloud detected tree heights and stem diameters to model missing stem diameters.”</a> MethodsX 9 (2022): 101729.</li>
<li>Tinkham, Wade T., Neal C. Swayze, Chad M. Hoffman, Lauren E. Lad, and Mike A. Battaglia. <a href="https://scholar.google.com/scholar?oi=bibs&amp;hl=en&amp;cluster=14807895789640069059" class="external-link">“Modeling the missing DBHs: Influence of model form on UAV DBH characterization.”</a> Forests 13, no. 12 (2022): 2077.</li>
<li>Creasy, Matthew B., Wade T. Tinkham, Chad M. Hoffman, and Jody C. Vogeler. <a href="https://scholar.google.com/scholar?oi=bibs&amp;hl=en&amp;cluster=10356932785437169630" class="external-link">“Potential for individual tree monitoring in ponderosa pine dominated forests using unmanned aerial system structure from motion point clouds.”</a> Canadian Journal of Forest Research 51, no. 8 (2021): 1093-1105.</li>
<li>Almeida, Danilo Roberti Alves de, Scott C. Stark, Gang Shao, Juliana Schietti, Bruce Walker Nelson, Carlos Alberto Silva, Eric Bastos Gorgens, Ruben Valbuena, Daniel de Almeida Papa, and Pedro Henrique Santin Brancalion. <a href="https://scholar.google.com/scholar?cluster=5085674356305592014&amp;hl=en&amp;as_sdt=0,6" class="external-link">“Optimizing the remote detection of tropical rainforest structure with airborne lidar: Leaf area profile sensitivity to pulse density and spatial sampling.”</a> Remote Sensing 11, no. 1 (2019): 92.</li>
<li>Viedma, O., C. A. Silva, J. M. Moreno, and A. T. Hudak. <a href="https://scholar.google.com/scholar?cluster=14042621889986838235&amp;oi=gsb&amp;hl=en&amp;as_sdt=0,6" class="external-link">“LadderFuelsR: A new automated tool for vertical fuel continuity analysis and crown base height detection using light detection and ranging.”</a> Methods in Ecology and Evolution (2024).</li>
</ul>
<p>The development and functionality of the <code>cloud2trees</code> package relies extensively on the groundbreaking work of others. We gratefully acknowledge and encourage users to properly cite the authors and contributors behind the following essential R packages:</p>
<ul>
<li>
<code>lidR</code> package (<a href="https://github.com/r-lidar/lidR" class="external-link uri">https://github.com/r-lidar/lidR</a>) for fundamental point cloud processing capabilities and routines</li>
<li>
<code>lasR</code> package (<a href="https://r-lidar.github.io/lasR" class="external-link uri">https://r-lidar.github.io/lasR</a>) enables large-scale point cloud processing with speed</li>
<li>
<code>TreeLS</code> package (<a href="https://github.com/tiagodc/TreeLS" class="external-link uri">https://github.com/tiagodc/TreeLS</a>) helps us extract DBH directly from the point cloud</li>
<li>
<code>leafR</code> package (<a href="https://github.com/DRAAlmeida/leafR" class="external-link uri">https://github.com/DRAAlmeida/leafR</a>) computes leaf area density (LAD) profiles from the point cloud</li>
<li>
<code>LadderFuelsR</code> package (<a href="https://github.com/olgaviedma/LadderFuelsR" class="external-link uri">https://github.com/olgaviedma/LadderFuelsR</a>) helps us extract CBH from the point cloud</li>
</ul>
</div>
<div class="section level1">
<h1 id="installation-and-setup">Installation and Setup<a class="anchor" aria-label="anchor" href="#installation-and-setup"></a>
</h1>
<p>A full demonstration of the install and setup of <code>cloud2trees</code> including dependencies is available at the <a href="articles/cloud2trees-setup.html">Setup demonstration</a></p>
<p>It is recommended that users follow this full install demonstration which includes program functionality checks after the installation steps are completed.</p>
</div>
<div class="section level1">
<h1 id="extract-trees-from-point-cloud-default">Extract Trees from Point Cloud: Default<a class="anchor" aria-label="anchor" href="#extract-trees-from-point-cloud-default"></a>
</h1>
<p>In addition to <code>cloud2trees</code>, we’ll be using the <code>tidyverse</code>, <code>sf</code>, and <code>terra</code> in the examples below.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://georgewoolsey.github.io/cloud2trees/">cloud2trees</a></span><span class="op">)</span></span>
<span><span class="co"># install.packages("tidyverse")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="co"># install.packages("sf")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="co"># install.packages("terra")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span></code></pre></div>
<p>The <code><a href="reference/cloud2trees.html">cloud2trees()</a></code> function is an all-in-one function to process raw .las|.laz files to generate a CHM raster (.tif), a DTM raster (.tif), and a tree list with tree location, height, and DBH.</p>
<p>For our example we’ll use the <code>MixedConifer.laz</code> that ships with the <code>lidR</code> package (<a href="https://r-lidar.github.io/lidRbook/" class="external-link uri">https://r-lidar.github.io/lidRbook/</a>).</p>
<p>A most basic example using all <code><a href="reference/cloud2trees.html">cloud2trees()</a></code> function defaults with a single .laz file and writing the output to a temporary directory is:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># a test las file but this could also be a directory path with &gt;1 .las|.laz files</span></span>
<span><span class="va">i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"MixedConifer.laz"</span>, package<span class="op">=</span><span class="st">"lidR"</span><span class="op">)</span></span>
<span><span class="co"># run it</span></span>
<span><span class="va">cloud2trees_ans</span> <span class="op">&lt;-</span> <span class="fu">cloud2trees</span><span class="fu">::</span><span class="fu"><a href="reference/cloud2trees.html">cloud2trees</a></span><span class="op">(</span>output_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, input_las_dir <span class="op">=</span> <span class="va">i</span><span class="op">)</span></span></code></pre></div>
<p>Let’s check out what is included in the return from the <code><a href="reference/cloud2trees.html">cloud2trees()</a></code> function.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># what is it?</span></span>
<span><span class="va">cloud2trees_ans</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "crowns_sf"       "treetops_sf"     "dtm_rast"        "chm_rast"       </span></span>
<span><span class="co">#&gt; [5] "foresttype_rast"</span></span></code></pre></div>
<p>There is a digital terrain model (DTM) raster which we can plot using <code><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">terra::plot()</a></code></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># there's a DTM</span></span>
<span><span class="va">cloud2trees_ans</span><span class="op">$</span><span class="va">dtm_rast</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-5-1.png" width="100%"></p>
<p>There is a canopy height model (CHM) raster which we can plot using <code><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">terra::plot()</a></code></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># there's a CHM</span></span>
<span><span class="va">cloud2trees_ans</span><span class="op">$</span><span class="va">chm_rast</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-6-1.png" width="100%"></p>
<p>A spatial data frame with tree crown polygons is returned.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># there are tree crowns</span></span>
<span><span class="va">cloud2trees_ans</span><span class="op">$</span><span class="va">crowns_sf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 340</span></span>
<span><span class="co">#&gt; Columns: 27</span></span>
<span><span class="co">#&gt; $ treeID                    &lt;chr&gt; "1_481294.4_3813010.9", "2_481312.9_3813010.…</span></span>
<span><span class="co">#&gt; $ tree_height_m             &lt;dbl&gt; 15.85, 13.44, 22.07, 22.93, 24.43, 22.23, 11…</span></span>
<span><span class="co">#&gt; $ tree_x                    &lt;dbl&gt; 481294.4, 481312.9, 481325.1, 481335.9, 4812…</span></span>
<span><span class="co">#&gt; $ tree_y                    &lt;dbl&gt; 3813011, 3813011, 3813011, 3813011, 3813011,…</span></span>
<span><span class="co">#&gt; $ crown_area_m2             &lt;dbl&gt; 10.8750, 6.5000, 6.3750, 27.0625, 10.1250, 1…</span></span>
<span><span class="co">#&gt; $ geometry                  &lt;GEOMETRY [m]&gt; POLYGON ((481292.5 3813011,..., POL…</span></span>
<span><span class="co">#&gt; $ fia_est_dbh_cm            &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ fia_est_dbh_cm_lower      &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ fia_est_dbh_cm_upper      &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ dbh_cm                    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ is_training_data          &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ dbh_m                     &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ radius_m                  &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ basal_area_m2             &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ basal_area_ft2            &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ ptcld_extracted_dbh_cm    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ ptcld_predicted_dbh_cm    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ tree_cbh_m                &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ is_training_cbh           &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ forest_type_group_code    &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ forest_type_group         &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ hardwood_softwood         &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ comp_trees_per_ha         &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ comp_relative_tree_height &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ comp_dist_to_nearest_m    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ max_crown_diam_height_m   &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ is_training_hmd           &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span></code></pre></div>
<p>Notice that all of the <code>dbh</code>, <code>cbh</code>, <code>forest_type</code>, HMD (<code>max_crown_diam_height_m</code>), and competition (<code>comp_</code>) columns do not have data. To estimate these values, we need to explicitly tell the <code><a href="reference/cloud2trees.html">cloud2trees()</a></code> to perform the processing required by setting the parameters:</p>
<ul>
<li>
<code>estimate_tree_dbh=TRUE</code> for DBH (see also <code><a href="reference/trees_dbh.html">trees_dbh()</a></code>)</li>
<li>
<code>estimate_tree_cbh=TRUE</code> for CBH (see also <code><a href="reference/trees_cbh.html">trees_cbh()</a></code>)</li>
<li>
<code>estimate_tree_type=TRUE</code> for forest type (see also <code><a href="reference/trees_type.html">trees_type()</a></code>)</li>
<li>
<code>estimate_tree_hmd=TRUE</code> for tree HMD (see also <code><a href="reference/trees_hmd.html">trees_hmd()</a></code>)</li>
<li>
<code>estimate_tree_competition=TRUE</code> for competition (see also <code><a href="reference/trees_competition.html">trees_competition()</a></code>)</li>
</ul>
<p>Let’s plot these tree crown polygons using <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot2::ggplot()</a></code> with some custom plot settings.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cloud2trees_ans</span><span class="op">$</span><span class="va">crowns_sf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">tree_height_m</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Oranges"</span>, name <span class="op">=</span> <span class="st">"tree ht. (m)"</span>, direction <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span>, legend.direction <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-8-1.png" width="100%"></p>
<p>A spatial data frame with tree top points is returned.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># there are tree top points</span></span>
<span><span class="va">cloud2trees_ans</span><span class="op">$</span><span class="va">treetops_sf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 340</span></span>
<span><span class="co">#&gt; Columns: 25</span></span>
<span><span class="co">#&gt; $ treeID                    &lt;chr&gt; "1_481294.4_3813010.9", "2_481312.9_3813010.…</span></span>
<span><span class="co">#&gt; $ tree_height_m             &lt;dbl&gt; 15.85, 13.44, 22.07, 22.93, 24.43, 22.23, 11…</span></span>
<span><span class="co">#&gt; $ crown_area_m2             &lt;dbl&gt; 10.8750, 6.5000, 6.3750, 27.0625, 10.1250, 1…</span></span>
<span><span class="co">#&gt; $ fia_est_dbh_cm            &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ fia_est_dbh_cm_lower      &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ fia_est_dbh_cm_upper      &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ dbh_cm                    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ is_training_data          &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ dbh_m                     &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ radius_m                  &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ basal_area_m2             &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ basal_area_ft2            &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ ptcld_extracted_dbh_cm    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ ptcld_predicted_dbh_cm    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ tree_cbh_m                &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ is_training_cbh           &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ forest_type_group_code    &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ forest_type_group         &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ hardwood_softwood         &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ comp_trees_per_ha         &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ comp_relative_tree_height &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ comp_dist_to_nearest_m    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ max_crown_diam_height_m   &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ is_training_hmd           &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ geometry                  &lt;POINT [m]&gt; POINT (481294.4 3813011), POINT (48131…</span></span></code></pre></div>
<p>Notice that <code>cloud2trees_ans$crowns_sf</code> and <code>cloud2trees_ans$treetops_sf</code> have the <em>exact same structure</em> but one is spatial polygons and the other is spatial points.</p>
<p>Let’s plot these tree top points using <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot2::ggplot()</a></code> with some custom plot settings.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cloud2trees_ans</span><span class="op">$</span><span class="va">treetops_sf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">tree_height_m</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Oranges"</span>, name <span class="op">=</span> <span class="st">"tree ht. (m)"</span>, direction <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span>, legend.direction <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-10-1.png" width="100%"></p>
<p>It is also the case that the points in <code>cloud2trees_ans$treetops_sf</code> will match to exactly one crown polygon in <code>cloud2trees_ans$crowns_sf</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">cloud2trees_ans</span><span class="op">$</span><span class="va">crowns_sf</span>, mapping <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">tree_height_m</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">cloud2trees_ans</span><span class="op">$</span><span class="va">treetops_sf</span>, shape <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Oranges"</span>, name <span class="op">=</span> <span class="st">"tree ht. (m)"</span>, direction <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span>, legend.direction <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-11-1.png" width="100%"></p>
</div>
<div class="section level1">
<h1 id="individual-tree-detection-itd-tuning">Individual Tree Detection (ITD) Tuning<a class="anchor" aria-label="anchor" href="#individual-tree-detection-itd-tuning"></a>
</h1>
<p>The <code>cloud2trees</code> package performs individual tree detection using <code><a href="https://rdrr.io/pkg/lidR/man/locate_trees.html" class="external-link">lidR::locate_trees()</a></code> with the <code><a href="https://rdrr.io/pkg/lidR/man/itd_lmf.html" class="external-link">lidR::lmf()</a></code> algorithm. The local maximum filter algorithm allows for a constant window size or a variable window size defined by a function. See the <code>lidR</code> <a href="https://r-lidar.github.io/lidRbook/itd.html" class="external-link">package book section</a> by point cloud processing expert <a href="https://github.com/Jean-Romain" class="external-link">Jean-Romain Roussel</a> for excellent detail on ITD and defining window size.</p>
<p>The <code><a href="reference/itd_tuning.html">itd_tuning()</a></code> function is used to visually assess tree crown delineation results from different window size functions used for the detection of individual trees. <code><a href="reference/itd_tuning.html">itd_tuning()</a></code> allows users to test different window size functions on a sample of data to determine which function is most suitable for the area being analyzed. The preferred function can then be used in the <code>ws</code> parameter in <code><a href="reference/raster2trees.html">raster2trees()</a></code> and <code><a href="reference/cloud2trees.html">cloud2trees()</a></code>.</p>
<p>It is generally recommended that a different window size function is defined for each region of your study area with significantly different forest structure. For example, one might want to define a different window size for each forest type or different silvicultural treatment. To accomplish this with the current version of <code>cloud2trees</code> will require the analyst to pre-process the aerial point cloud data to split up these distinct regions, perform ITD on each region, and compile the tree list in post-processing.</p>
<div class="section level2">
<h2 id="default-itd-window-size-functions">Default ITD window size functions<a class="anchor" aria-label="anchor" href="#default-itd-window-size-functions"></a>
</h2>
<p>We’ll continue to use the <code>MixedConifer.laz</code> that ships with the <code>lidR</code> package for our example. <code><a href="reference/itd_tuning.html">itd_tuning()</a></code> enables users to sample from up to five 0.1 ha plots (<code>n_samples</code> parameter) that are randomly selected from within the bounding box of the point cloud data coverage. A function or a named list of functions can be tested using the <code>ws_fn_list</code> parameter which can also be left at the default value (<code>NULL</code>) to test default exponential (concave up), linear, and logarithmic (concave down) functions. We’ll run <code><a href="reference/itd_tuning.html">itd_tuning()</a></code> with all default options to start.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">itd_tuning_ans</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/itd_tuning.html">itd_tuning</a></span><span class="op">(</span>input_las_dir <span class="op">=</span> <span class="va">i</span>, n_samples <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>Let’s check out what is included in the return from the <code><a href="reference/itd_tuning.html">itd_tuning()</a></code> function.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># what is it?</span></span>
<span><span class="va">itd_tuning_ans</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "plot_samples"        "ws_fn_list"          "plot_sample_summary"</span></span></code></pre></div>
<p>There is a plot of the different ITD window size functions tested (columns) over the different 0.1 ha sample plots (plot rows) and the number of individual trees extracted shown outlined in gray overlaid on the canopy height model (CHM).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">itd_tuning_ans</span><span class="op">$</span><span class="va">plot_samples</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-14-1.png" width="100%"></p>
<p>There is a plot that summarizes the trees detected based on the different ITD window search functions tested for each sample plot area. The first view provides aggregated plot summary metrics including trees per hectare (TPH), mean tree height in meters, and mean crown diameter in meters. The second view shows the tree size-class distribution showing the proportion of trees (bar label) and count of trees (y-axis) using five equally spaced height bins to enhance insight into the effect of the search function. For example, this distribution can help diagnose issues such as the over-segmentation of small trees, which can inflate TPH estimates, or, conversely, the failure to detect a targeted height-class range. The third view shows the tree height-to-crown diameter relationship. The goal of the window search function is to accurately model this relationship, and a positive correlation is expected across most forest types with any deviations from the general trend suggesting a need for further tuning (e.g. small trees with unrealistically wide crowns).</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">itd_tuning_ans</span><span class="op">$</span><span class="va">plot_sample_summary</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-15-1.png" width="100%"></p>
<p>if we think that the “lin_fn” was the most appropriate for our area, we can access the function from the returned list of window size functions and store it for use in <code><a href="reference/raster2trees.html">raster2trees()</a></code> and <code><a href="reference/cloud2trees.html">cloud2trees()</a></code></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get the best function</span></span>
<span><span class="va">best_ws</span> <span class="op">&lt;-</span> <span class="va">itd_tuning_ans</span><span class="op">$</span><span class="va">ws_fn_list</span><span class="op">$</span><span class="va">lin_fn</span></span></code></pre></div>
<p>we can plot what the function looks like</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html" class="external-link">geom_function</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">best_ws</span>, color <span class="op">=</span> <span class="st">"brown"</span>, lwd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>,<span class="fl">60</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"heights"</span>, y <span class="op">=</span> <span class="st">"ws"</span>, color <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_light</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-17-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="custom-itd-window-size-functions">Custom ITD window size functions<a class="anchor" aria-label="anchor" href="#custom-itd-window-size-functions"></a>
</h2>
<p>Let’s work through how to test some custom window size functions. We’ll test a constant window size of 3 m and a custom function where the windows size is linearly related to the point height</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># a constant window size has to be defined as:</span></span>
<span> <span class="co">## rep(constant, times = length(x))</span></span>
<span> <span class="co">## x*0 + constant</span></span>
<span>  <span class="va">my_constant</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span> </span>
<span>   <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">3</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span> <span class="co">## will always return 3</span></span>
<span>  <span class="op">}</span> </span>
<span><span class="co"># a custom linear function</span></span>
<span> <span class="va">my_linear</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="op">(</span><span class="va">x</span> <span class="op">*</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span> <span class="fl">3</span><span class="op">}</span></span>
<span><span class="co"># let's put these in a list to test with the best default function we saved from above</span></span>
<span>  <span class="va">my_fn_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    my_constant <span class="op">=</span> <span class="va">my_constant</span></span>
<span>    , my_linear <span class="op">=</span> <span class="va">my_linear</span></span>
<span>    , best_default_ws <span class="op">=</span> <span class="va">best_ws</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>run <code><a href="reference/itd_tuning.html">itd_tuning()</a></code> with our custom window size definitions and try on two sample plots of 0.1 ha</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># run it with custom functions</span></span>
<span><span class="va">itd_tuning_ans2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/itd_tuning.html">itd_tuning</a></span><span class="op">(</span></span>
<span> input_las_dir <span class="op">=</span> <span class="va">i</span></span>
<span> , ws_fn_list <span class="op">=</span> <span class="va">my_fn_list</span></span>
<span> , n_samples <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>let’s check out that tuning plot</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># look at the tuning plot</span></span>
<span><span class="va">itd_tuning_ans2</span><span class="op">$</span><span class="va">plot_samples</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-20-1.png" width="100%"></p>
<p>we can also check out what our custom “my_linear” function looks like</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html" class="external-link">geom_function</a></span><span class="op">(</span></span>
<span>    fun <span class="op">=</span> <span class="va">itd_tuning_ans2</span><span class="op">$</span><span class="va">ws_fn_list</span><span class="op">$</span><span class="va">my_linear</span></span>
<span>    , color <span class="op">=</span> <span class="st">"gold"</span></span>
<span>    , lwd <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>,<span class="fl">60</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>,<span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"heights"</span>, y <span class="op">=</span> <span class="st">"ws"</span>, color <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_light</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-21-1.png" width="100%"></p>
</div>
</div>
<div class="section level1">
<h1 id="extract-trees-from-point-cloud-custom">Extract Trees from Point Cloud: Custom<a class="anchor" aria-label="anchor" href="#extract-trees-from-point-cloud-custom"></a>
</h1>
<p>We’ll continue to use the <code>MixedConifer.laz</code> that ships with the <code>lidR</code> package for our example.</p>
<p>Customizing the <code><a href="reference/cloud2trees.html">cloud2trees()</a></code> function parameters we’ll:</p>
<ul>
<li>Change the resolution of the DTM using <code>dtm_res_m</code>
</li>
<li>Change moving window used to detect the local maxima tree tops using <code>ws</code> with our best window size from our <code><a href="reference/itd_tuning.html">itd_tuning()</a></code> exploration above</li>
<li>Estimate tree DBH using allometry from FIA plot data with <code>estimate_tree_dbh</code>
</li>
<li>Extract tree FIA Forest Type Group with <code>estimate_tree_type</code>
</li>
<li>Quantify tree competition metrics with <code>estimate_tree_competition</code>
</li>
<li>Extract tree CBH from the point cloud with <code>estimate_tree_cbh</code> for a sample of 555 trees using <code>cbh_tree_sample_n</code>
</li>
<li>Model the remaining tree CBH values with <code>cbh_estimate_missing_cbh</code> based on our sample of 555 trees</li>
<li>Extract tree height to maximum crown diameter (HMD) from the point cloud with <code>estimate_tree_hmd</code> for a sample of 50% trees using <code>hmd_tree_sample_prop</code>
</li>
<li>Model the remaining tree HMD values with <code>hmd_estimate_missing_hmd</code> based on our sample</li>
<li>Estimate tree crown biomass using the LANDFIRE CBD product with <code>estimate_biomass_method</code>
</li>
</ul>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># make sure we know where the results are going</span></span>
<span><span class="va">my_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># run it</span></span>
<span><span class="va">cloud2trees_ans_c</span> <span class="op">&lt;-</span> <span class="fu">cloud2trees</span><span class="fu">::</span><span class="fu"><a href="reference/cloud2trees.html">cloud2trees</a></span><span class="op">(</span></span>
<span>  output_dir <span class="op">=</span> <span class="va">my_dir</span></span>
<span>  , input_las_dir <span class="op">=</span> <span class="va">i</span></span>
<span>  , dtm_res_m <span class="op">=</span> <span class="fl">0.5</span></span>
<span>  , ws <span class="op">=</span> <span class="va">best_ws</span></span>
<span>  , estimate_tree_dbh <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  , estimate_tree_type <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  , estimate_tree_competition <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  , estimate_tree_cbh <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  , cbh_tree_sample_n <span class="op">=</span> <span class="fl">555</span></span>
<span>  , cbh_estimate_missing_cbh <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  , estimate_tree_hmd <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  , hmd_tree_sample_prop <span class="op">=</span> <span class="fl">0.5</span></span>
<span>  , hmd_estimate_missing_hmd <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  , estimate_biomass_method <span class="op">=</span> <span class="st">"landfire"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Check how the digital terrain model (DTM) raster has changed</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span></span>
<span>  <span class="st">"Default DTM resolution:"</span></span>
<span>  , <span class="va">cloud2trees_ans</span><span class="op">$</span><span class="va">dtm_rast</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">res</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span>collapse <span class="op">=</span> <span class="st">","</span><span class="op">)</span></span>
<span>  , <span class="st">"|| Custom DTM resolution:"</span></span>
<span>  , <span class="va">cloud2trees_ans_c</span><span class="op">$</span><span class="va">dtm_rast</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">res</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span>collapse <span class="op">=</span> <span class="st">","</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Default DTM resolution: 1,1 || Custom DTM resolution: 0.5,0.5"</span></span></code></pre></div>
<p>Check that our spatial data frame with tree crown polygons has data on DBH (<code>dbh_*</code>), CBH (<code>tree_cbh_m</code>), HMD (<code>max_crown_diam_height_m</code>), <code>forest_type_*</code>, competition (<code>comp_*</code>), and crown biomass using the LANDFIRE data (<code>landfire_*</code>).</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cloud2trees_ans_c</span><span class="op">$</span><span class="va">crowns_sf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 343</span></span>
<span><span class="co">#&gt; Columns: 34</span></span>
<span><span class="co">#&gt; $ treeID                    &lt;chr&gt; "1_481281.4_3813010.9", "2_481294.4_3813010.…</span></span>
<span><span class="co">#&gt; $ tree_height_m             &lt;dbl&gt; 22.23, 15.85, 10.06, 13.44, 22.07, 22.48, 22…</span></span>
<span><span class="co">#&gt; $ tree_x                    &lt;dbl&gt; 481281.4, 481294.4, 481306.4, 481312.9, 4813…</span></span>
<span><span class="co">#&gt; $ tree_y                    &lt;dbl&gt; 3813011, 3813011, 3813011, 3813011, 3813011,…</span></span>
<span><span class="co">#&gt; $ crown_area_m2             &lt;dbl&gt; 10.3750, 10.8125, 1.1875, 4.5625, 6.3750, 10…</span></span>
<span><span class="co">#&gt; $ geometry                  &lt;GEOMETRY [m]&gt; MULTIPOLYGON (((481280.5 38..., POL…</span></span>
<span><span class="co">#&gt; $ fia_est_dbh_cm            &lt;dbl&gt; 49.489231, 31.309071, 17.135796, 24.843153, …</span></span>
<span><span class="co">#&gt; $ fia_est_dbh_cm_lower      &lt;dbl&gt; 27.746832, 17.725274, 9.644044, 14.225778, 2…</span></span>
<span><span class="co">#&gt; $ fia_est_dbh_cm_upper      &lt;dbl&gt; 75.479259, 48.115126, 26.246084, 38.082835, …</span></span>
<span><span class="co">#&gt; $ dbh_cm                    &lt;dbl&gt; 49.489231, 31.309071, 17.135796, 24.843153, …</span></span>
<span><span class="co">#&gt; $ is_training_data          &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FA…</span></span>
<span><span class="co">#&gt; $ dbh_m                     &lt;dbl&gt; 0.49489231, 0.31309071, 0.17135796, 0.248431…</span></span>
<span><span class="co">#&gt; $ radius_m                  &lt;dbl&gt; 0.24744616, 0.15654536, 0.08567898, 0.124215…</span></span>
<span><span class="co">#&gt; $ basal_area_m2             &lt;dbl&gt; 0.192358462, 0.076989280, 0.023062080, 0.048…</span></span>
<span><span class="co">#&gt; $ basal_area_ft2            &lt;dbl&gt; 2.07054648, 0.82871261, 0.24824023, 0.521767…</span></span>
<span><span class="co">#&gt; $ ptcld_extracted_dbh_cm    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ ptcld_predicted_dbh_cm    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ tree_cbh_m                &lt;dbl&gt; 15.500000, 8.500000, 7.012133, 11.720800, 20…</span></span>
<span><span class="co">#&gt; $ is_training_cbh           &lt;lgl&gt; TRUE, TRUE, FALSE, FALSE, TRUE, TRUE, TRUE, …</span></span>
<span><span class="co">#&gt; $ forest_type_group_code    &lt;chr&gt; "220", "220", "220", "220", "220", "220", "2…</span></span>
<span><span class="co">#&gt; $ forest_type_group         &lt;chr&gt; "Ponderosa pine group", "Ponderosa pine grou…</span></span>
<span><span class="co">#&gt; $ hardwood_softwood         &lt;chr&gt; "Softwood", "Softwood", "Softwood", "Softwoo…</span></span>
<span><span class="co">#&gt; $ comp_trees_per_ha         &lt;dbl&gt; 495.0296, 742.5445, 742.5445, 990.0593, 742.…</span></span>
<span><span class="co">#&gt; $ comp_relative_tree_height &lt;dbl&gt; 0.9099468, 1.0000000, 0.5804963, 1.0000000, …</span></span>
<span><span class="co">#&gt; $ comp_dist_to_nearest_m    &lt;dbl&gt; 3.010399, 2.549510, 1.677051, 1.414214, 3.60…</span></span>
<span><span class="co">#&gt; $ max_crown_diam_height_m   &lt;dbl&gt; 10.644080, 10.660000, 6.370394, 10.096082, 1…</span></span>
<span><span class="co">#&gt; $ is_training_hmd           &lt;lgl&gt; FALSE, TRUE, FALSE, FALSE, TRUE, FALSE, FALS…</span></span>
<span><span class="co">#&gt; $ landfire_stand_id         &lt;dbl&gt; 49, 50, 50, 50, 51, 51, 51, 49, 50, 50, 51, …</span></span>
<span><span class="co">#&gt; $ crown_dia_m               &lt;dbl&gt; 3.6345371, 3.7103777, 1.2296227, 2.4102190, …</span></span>
<span><span class="co">#&gt; $ crown_length_m            &lt;dbl&gt; 6.7299995, 7.3500004, 3.0478671, 1.7191996, …</span></span>
<span><span class="co">#&gt; $ crown_volume_m3           &lt;dbl&gt; 46.5491635, 52.9812527, 2.4128948, 5.2292321…</span></span>
<span><span class="co">#&gt; $ landfire_tree_kg_per_m3   &lt;dbl&gt; 0.2167401, 0.1645076, 0.1645076, 0.1645076, …</span></span>
<span><span class="co">#&gt; $ landfire_stand_kg_per_m3  &lt;dbl&gt; 0.08, 0.08, 0.08, 0.08, 0.08, 0.08, 0.08, 0.…</span></span>
<span><span class="co">#&gt; $ landfire_crown_biomass_kg &lt;dbl&gt; 10.08907036, 8.71581875, 0.39693953, 0.86024…</span></span></code></pre></div>
<p>Remember, we also changed the <code>ws</code> parameter used to detect the local maxima for identifying tree tops so we got a few more trees compared to the default settings.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span></span>
<span>  <span class="st">"Default trees extracted:"</span></span>
<span>  , <span class="va">cloud2trees_ans</span><span class="op">$</span><span class="va">crowns_sf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  , <span class="st">"|| Custom trees extracted:"</span></span>
<span>  , <span class="va">cloud2trees_ans_c</span><span class="op">$</span><span class="va">crowns_sf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Default trees extracted: 340 || Custom trees extracted: 343"</span></span></code></pre></div>
<p>Let’s look at the relationship between tree height and tree DBH estimated from the FIA plot data.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cloud2trees_ans_c</span><span class="op">$</span><span class="va">crowns_sf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">tree_height_m</span>, y <span class="op">=</span> <span class="va">dbh_cm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"navy"</span>, alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"tree ht. (m)"</span>, y <span class="op">=</span> <span class="st">"tree DBH (cm)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_light</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-26-1.png" width="100%"></p>
<p>Let’s look at the relationship between tree height and tree CBH as extracted from the point cloud. Note, that we do not expect a perfect linear relationship between tree height and CBH throughout the entire height range because CBH is also determined spatially (e.g. as a fire moves through a stand).</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cloud2trees_ans_c</span><span class="op">$</span><span class="va">crowns_sf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">is_training_cbh</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">tree_height_m</span>, y <span class="op">=</span> <span class="va">tree_cbh_m</span>, color<span class="op">=</span><span class="va">is_training_cbh</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"tree ht. (m)"</span>, y <span class="op">=</span> <span class="st">"tree CBH (m)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/breaks_extended.html" class="external-link">extended_breaks</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">12</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/breaks_extended.html" class="external-link">extended_breaks</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">14</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_d</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.8</span>, name <span class="op">=</span> <span class="st">"is CBH\nfrom cloud?"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_light</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-27-1.png" width="100%"></p>
<p>We can also plot height, diameter, and CBH of trees spatially and we’ll use the <code>patchwork</code> package to combine our plots.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="co"># height plot</span></span>
<span><span class="va">plt_ht</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">cloud2trees_ans_c</span><span class="op">$</span><span class="va">crowns_sf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">tree_height_m</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Oranges"</span>, name <span class="op">=</span> <span class="st">"tree ht. (m)"</span>, direction <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span>, legend.direction <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span></span>
<span><span class="co"># diameter plot</span></span>
<span><span class="va">plt_dbh</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">cloud2trees_ans_c</span><span class="op">$</span><span class="va">crowns_sf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">dbh_cm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Purples"</span>, name <span class="op">=</span> <span class="st">"tree DBH (cm)"</span>, direction <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span>, legend.direction <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span></span>
<span><span class="co"># CBH plot</span></span>
<span><span class="va">plt_cbh</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">cloud2trees_ans_c</span><span class="op">$</span><span class="va">crowns_sf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">tree_cbh_m</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Greens"</span>, name <span class="op">=</span> <span class="st">"tree CBH (m)"</span>, direction <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span>, legend.direction <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span></span>
<span><span class="co"># combine with patchwork</span></span>
<span><span class="va">plt_ht</span> <span class="op">+</span> <span class="va">plt_dbh</span> <span class="op">+</span> <span class="va">plt_cbh</span> <span class="op">+</span> <span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    legend.title <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span>    , legend.text <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-28-1.png" width="100%"></p>
<p>Let’s plot the distance to the nearest tree that we obtained by turning on the <code>estimate_tree_competition</code> parameter in the <code><a href="reference/cloud2trees.html">cloud2trees()</a></code> function call to quantify tree competition metrics. We’ll use the spatial tree points data in <code>cloud2trees_ans_c$treetops_sf</code>.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cloud2trees_ans_c</span><span class="op">$</span><span class="va">treetops_sf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">comp_dist_to_nearest_m</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Greys"</span>, name <span class="op">=</span> <span class="st">"distance to\nnearest tree"</span>, direction <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span>, legend.direction <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-29-1.png" width="100%"></p>
<p>Let’s look at the FIA Forest Type Group data we extracted for the tree list.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cloud2trees_ans_c</span><span class="op">$</span><span class="va">treetops_sf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">forest_type_group_code</span>, <span class="va">forest_type_group</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 3</span></span>
<span><span class="co">#&gt;   forest_type_group_code forest_type_group        n</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                  &lt;chr&gt;                &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 220                    Ponderosa pine group   343</span></span></code></pre></div>
<div class="section level2">
<h2 id="cloud2trees-outputs">
<code>cloud2trees()</code> outputs<a class="anchor" aria-label="anchor" href="#cloud2trees-outputs"></a>
</h2>
<p>The <code><a href="reference/cloud2trees.html">cloud2trees()</a></code> process generates a list of outputs which are written to the disk in a delivery directory titled <em>point_cloud_processing_delivery</em> in the <code>output_dir</code> argument defined by the user in the function call.</p>
<p>The astute reader will have noticed that we saved our outputs to a temporary directory (<code>my_dir</code>) but this could have been any directory on our local machine (e.g. “C:”). Let’s check out the files that were delivered in the <em>point_cloud_processing_delivery</em> folder.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># append the "point_cloud_processing_delivery"  to our output_dir</span></span>
<span><span class="va">cloud2trees_delivery_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">my_dir</span>,<span class="st">"point_cloud_processing_delivery"</span><span class="op">)</span></span>
<span><span class="co"># which files?</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span> <span class="va">cloud2trees_delivery_dir</span> <span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "cbh_height_model_estimates.rds"             </span></span>
<span><span class="co">#&gt;  [2] "chm_0.25m.tif"                              </span></span>
<span><span class="co">#&gt;  [3] "dtm_0.5m.tif"                               </span></span>
<span><span class="co">#&gt;  [4] "fia_foresttype_raster.tif"                  </span></span>
<span><span class="co">#&gt;  [5] "final_detected_crowns.gpkg"                 </span></span>
<span><span class="co">#&gt;  [6] "final_detected_tree_tops.gpkg"              </span></span>
<span><span class="co">#&gt;  [7] "hmd_height_model_estimates.rds"             </span></span>
<span><span class="co">#&gt;  [8] "norm_las"                                   </span></span>
<span><span class="co">#&gt;  [9] "processed_tracking_data.csv"                </span></span>
<span><span class="co">#&gt; [10] "raw_las_ctg_info.gpkg"                      </span></span>
<span><span class="co">#&gt; [11] "regional_dbh_height_model.rds"              </span></span>
<span><span class="co">#&gt; [12] "regional_dbh_height_model_estimates.csv"    </span></span>
<span><span class="co">#&gt; [13] "regional_dbh_height_model_predictions.csv"  </span></span>
<span><span class="co">#&gt; [14] "regional_dbh_height_model_training_data.csv"</span></span>
<span><span class="co">#&gt; [15] "stand_cell_data_landfire.csv"</span></span></code></pre></div>
<p>here is a description of each of those files:</p>
<table class="table">
<colgroup>
<col width="25%">
<col width="12%">
<col width="62%">
</colgroup>
<thead><tr class="header">
<th>File Name</th>
<th>File Type</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>cbh_height_model_estimates.rds</td>
<td>R Data Serialization</td>
<td>saved R object of random forest model predicting tree crown base height</td>
</tr>
<tr class="even">
<td>chm_0.25m_tif</td>
<td>GeoTif</td>
<td>canopy height model derived at user-defined resolution</td>
</tr>
<tr class="odd">
<td>dtm_1m.tif</td>
<td>GeoTif</td>
<td>digital terrain model derived at user-defined resolution</td>
</tr>
<tr class="even">
<td>fia_foresttype_raster.tif</td>
<td>GeoTif</td>
<td>30 m resolution raster of predicted forest type</td>
</tr>
<tr class="odd">
<td>final_detected_crowns.gpkg</td>
<td>Geopackage</td>
<td>polygons of individual tree crowns with appended tree level attributes</td>
</tr>
<tr class="even">
<td>final_detected_tree_tops.gpkg</td>
<td>Geopackage</td>
<td>tree top point locations of individual trees with appended tree level attributes</td>
</tr>
<tr class="odd">
<td>hmd_height_model_estimates.rds</td>
<td>R Data Serialization</td>
<td>saved R object of random forest model predicting tree height to max crown diameter</td>
</tr>
<tr class="even">
<td>processed_tracking_data.csv</td>
<td>CSV</td>
<td>summary table of data processing time for each step from DTM/CHM generation through modeling tree parameters</td>
</tr>
<tr class="odd">
<td>raw_las_ctg_info.gpkg</td>
<td>Geopackage</td>
<td>polygon of point cloud tiles tiles used in data processing</td>
</tr>
<tr class="even">
<td>regional_dbh_height_model.rds</td>
<td>R Data Serialization</td>
<td>saved R object of polynomial regression to predict tree diameter at breast height</td>
</tr>
<tr class="odd">
<td>regional_dbh_height_model_estimates.csv</td>
<td>CSV</td>
<td>table of predicted coefficient values of polynomial regression to predict tree diameter at breast height</td>
</tr>
<tr class="even">
<td>regional_dbh_height_model_predictions.csv</td>
<td>CSV</td>
<td>predicted diameter at breast height from polynomial regression at 0.1 m height increments</td>
</tr>
<tr class="odd">
<td>regional_dbh_height_model_training_data.csv</td>
<td>CSV</td>
<td>table of TreeMap tree data used to train diameter at breast height prediction model</td>
</tr>
<tr class="even">
<td>stand_cell_data_landfire.csv</td>
<td>CSV</td>
<td>table of parameters used to convert LANDFIRE CBD to tree-level crown bulk density</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level1">
<h1 id="format-cloud2trees-output-for-lanl-trees">Format <code>cloud2trees()</code> output for LANL TREES<a class="anchor" aria-label="anchor" href="#format-cloud2trees-output-for-lanl-trees"></a>
</h1>
<p>We developed the <code><a href="reference/cloud2trees_to_lanl_trees.html">cloud2trees_to_lanl_trees()</a></code> function to use the output from <code><a href="reference/cloud2trees.html">cloud2trees()</a></code> to generate inputs for the <a href="https://github.com/lanl/Trees/" class="external-link">LANL TREES</a> program as a pathway to fire modeling with <a href="https://doi.org/10.1016/j.envsoft.2019.104616" class="external-link">Quic-Fire</a></p>
<p>If you want to use the <code><a href="reference/cloud2trees.html">cloud2trees()</a></code> framework to generate all of the required fire modeling input variables, the minimum required settings are:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">cloud2trees</span><span class="fu">::</span><span class="fu"><a href="reference/cloud2trees.html">cloud2trees</a></span><span class="op">(</span></span>
<span>  <span class="va">...</span></span>
<span>  , estimate_tree_dbh <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  , estimate_tree_type <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  , estimate_tree_cbh <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  , cbh_estimate_missing_cbh <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  , estimate_tree_hmd <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  , hmd_estimate_missing_hmd <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  , estimate_biomass_method <span class="op">=</span> <span class="st">"landfire"</span> <span class="co"># or "cruz" or both c("landfire","cruz")</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The primary input of <code><a href="reference/cloud2trees_to_lanl_trees.html">cloud2trees_to_lanl_trees()</a></code> is a directory with outputs from <code><a href="reference/cloud2trees.html">cloud2trees()</a></code>. As a reminder, the default directory written by <code><a href="reference/cloud2trees.html">cloud2trees()</a></code> is <em>point_cloud_processing_delivery</em>. Also required is a spatial file defining the boundary of our area of interest.</p>
<p>We’ll pretend our area of interest is the central 2,000 m<sup>2</sup> of our point cloud data</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_aoi</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">cloud2trees_ans_c</span><span class="op">$</span><span class="va">treetops_sf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html" class="external-link">st_union</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_centroid</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_buffer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">2000</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>, endCapStyle <span class="op">=</span> <span class="st">"SQUARE"</span><span class="op">)</span></span>
<span><span class="co"># what is this?</span></span>
<span><span class="va">my_aoi</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; sfc_POLYGON of length 1; first list element: List of 1</span></span>
<span><span class="co">#&gt;  $ : num [1:5, 1:2] 481328 481328 481283 481283 481328 ...</span></span>
<span><span class="co">#&gt;  - attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"</span></span></code></pre></div>
<p>Now, we’ll call the function and tell it where our <code><a href="reference/cloud2trees.html">cloud2trees()</a></code> outputs are located and what our study area is. We’ll also tell it just to write the inputs for the <a href="https://github.com/lanl/Trees/" class="external-link">LANL TREES</a> program to the same directory and the program will automatically create a new folder titled <em>lanl_trees_delivery</em></p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># run it with no customization</span></span>
<span><span class="fu"><a href="reference/cloud2trees_to_lanl_trees.html">cloud2trees_to_lanl_trees</a></span><span class="op">(</span></span>
<span>  input_dir <span class="op">=</span> <span class="va">cloud2trees_delivery_dir</span></span>
<span>  , study_boundary <span class="op">=</span> <span class="va">my_aoi</span></span>
<span>  , output_dir <span class="op">=</span> <span class="va">cloud2trees_delivery_dir</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Let’s check out the files that were delivered in the <em>lanl_trees_delivery</em> folder.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># append the "lanl_trees_delivery" to our cloud2trees_delivery_dir</span></span>
<span><span class="va">lanl_trees_delivery_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">cloud2trees_delivery_dir</span>,<span class="st">"lanl_trees_delivery"</span><span class="op">)</span></span>
<span><span class="co"># which files?</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span> <span class="va">lanl_trees_delivery_dir</span> <span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Cloud2Trees_TreeList.txt" "dtm_Clipped.tif"         </span></span>
<span><span class="co">#&gt; [3] "fuellist"                 "Lidar_Bounds.geojson"    </span></span>
<span><span class="co">#&gt; [5] "topo.dat"</span></span></code></pre></div>
<p>here is a description of each of those files:</p>
<table class="table">
<colgroup>
<col width="10%">
<col width="15%">
<col width="74%">
</colgroup>
<thead><tr class="header">
<th>File Name</th>
<th>File Type</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Cloud2Trees_TreeList.txt</td>
<td>text</td>
<td>tree list with formatted spacing containing tree parameters necessary for input to the LANL TREES program</td>
</tr>
<tr class="even">
<td>dtm_Clipped.tif</td>
<td>GeoTif</td>
<td>digital terrain model clipped to a rectangular extent and scaled to 2 m resolution for use in LANL TREES program</td>
</tr>
<tr class="odd">
<td>fuellist</td>
<td>raw</td>
<td>file describing treelist file and surface fuel litter and herbaceous bulk density, depth, surface area to volume, and moisture as user defined constants for use in the LANL TREES program</td>
</tr>
<tr class="even">
<td>Lidar_Bounds.geojson</td>
<td>Geographic JavaScript Object Notation</td>
<td>projected polygon delineating the data and simulation extent</td>
</tr>
<tr class="odd">
<td>topo.dat</td>
<td>DAT</td>
<td>digital terrain model elevation data stored in FORTRAN format for use in LANL TREES program</td>
</tr>
</tbody>
</table>
<div class="section level2">
<h2 id="define-surface-fuel">Define surface fuel<a class="anchor" aria-label="anchor" href="#define-surface-fuel"></a>
</h2>
<p>The current iteration of <code><a href="reference/cloud2trees_to_lanl_trees.html">cloud2trees_to_lanl_trees()</a></code> requires the user to specify surface fuel load parameters, such as litter and herbaceous/grass fuel loads, which are assumed constant across the study area. Surface fuel loading parameters should be determined through a literature review or expert opinion.</p>
<p>The <code>fuel_litter</code> argument of the <code><a href="reference/cloud2trees_to_lanl_trees.html">cloud2trees_to_lanl_trees()</a></code> function allows users to define the litter fuel load with the parameters in order:</p>
<ul>
<li>
<em>ilitter</em> : 0 = no litter, 1 = litter</li>
<li>
<em>lrho</em> : litter bulk density (kg/m3)</li>
<li>
<em>lmoisture</em>: litter moisture (percent on 0-1 scale)</li>
<li>
<em>lss</em> : litter sizescale (m)</li>
<li>
<em>ldepth</em> : litter depth (m)</li>
</ul>
<p>The <code>fuel_grass</code> argument of the <code><a href="reference/cloud2trees_to_lanl_trees.html">cloud2trees_to_lanl_trees()</a></code> function allows users to define the grass/herbaceous fuel load with the parameters in order:</p>
<ul>
<li>
<em>igrass</em> : 0 = no grass, 1 = grass</li>
<li>
<em>grho</em> : grass bulk density (kg/m3)</li>
<li>
<em>gmoisture</em> : grass moisture (percent on 0-1 scale)</li>
<li>
<em>gss</em> : grass sizescale (m)</li>
<li>
<em>gdepth</em> : grass depth (m)</li>
</ul>
<p>here is what customizing these fuel loads would look like in the <code><a href="reference/cloud2trees_to_lanl_trees.html">cloud2trees_to_lanl_trees()</a></code> call</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># fuel_litter</span></span>
<span><span class="va">my_fuel_litter</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  ilitter <span class="op">=</span> <span class="fl">1</span></span>
<span>  , lrho <span class="op">=</span> <span class="fl">13.44</span></span>
<span>  , lmoisture <span class="op">=</span> <span class="fl">0.09</span></span>
<span>  , lss <span class="op">=</span> <span class="fl">0.00041</span></span>
<span>  , ldepth <span class="op">=</span> <span class="fl">0.032</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># fuel_grass</span></span>
<span><span class="va">my_fuel_grass</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  igrass <span class="op">=</span> <span class="fl">1</span></span>
<span>  , grho <span class="op">=</span> <span class="fl">0.0065</span></span>
<span>  , gmoisture <span class="op">=</span> <span class="fl">0.3</span></span>
<span>  , gss <span class="op">=</span> <span class="fl">0.00033</span></span>
<span>  , gdepth <span class="op">=</span> <span class="fl">0.15</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># run it with all customization</span></span>
<span><span class="fu"><a href="reference/cloud2trees_to_lanl_trees.html">cloud2trees_to_lanl_trees</a></span><span class="op">(</span></span>
<span>  input_dir <span class="op">=</span> <span class="va">cloud2trees_delivery_dir</span></span>
<span>  , study_boundary <span class="op">=</span> <span class="va">my_aoi</span></span>
<span>  , output_dir <span class="op">=</span> <span class="va">cloud2trees_delivery_dir</span></span>
<span>  , topofile <span class="op">=</span> <span class="st">"flat"</span></span>
<span>  , fuel_litter <span class="op">=</span> <span class="va">my_fuel_litter</span></span>
<span>  , fuel_grass <span class="op">=</span> <span class="va">my_fuel_grass</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level1">
<h1 id="extract-raster-data-from-point-cloud">Extract Raster Data from Point Cloud<a class="anchor" aria-label="anchor" href="#extract-raster-data-from-point-cloud"></a>
</h1>
<p>We can use the <code><a href="reference/cloud2raster.html">cloud2raster()</a></code> function if we only want to create a DTM and CHM from our point cloud data. This function also creates a classified and height normalized point cloud in the process. If you wish to keep these point clouds, ensure to turn on the <code>keep_intrmdt</code> parameter and see the <code>point_cloud_processing_temp</code> directory nested in the <code>output_dir</code>.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cloud2raster_ans</span> <span class="op">&lt;-</span> <span class="fu">cloud2trees</span><span class="fu">::</span><span class="fu"><a href="reference/cloud2raster.html">cloud2raster</a></span><span class="op">(</span>output_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, input_las_dir <span class="op">=</span> <span class="va">i</span><span class="op">)</span></span></code></pre></div>
<p>There is a digital terrain model (DTM) raster which we can plot using <code><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">terra::plot()</a></code></p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># there's a DTM</span></span>
<span><span class="va">cloud2raster_ans</span><span class="op">$</span><span class="va">dtm_rast</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-39-1.png" width="100%"></p>
<p>There is a canopy height model (CHM) raster which we can plot using <code><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">terra::plot()</a></code></p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># there's a CHM</span></span>
<span><span class="va">cloud2raster_ans</span><span class="op">$</span><span class="va">chm_rast</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-40-1.png" width="100%"></p>
</div>
<div class="section level1">
<h1 id="extract-trees-from-raster-data">Extract Trees from Raster Data<a class="anchor" aria-label="anchor" href="#extract-trees-from-raster-data"></a>
</h1>
<p>We can use the <code><a href="reference/raster2trees.html">raster2trees()</a></code> function if we already have a CHM raster and want to extract a tree list.</p>
<p>We’ll use the CHM example that ships with the <code>cloud2trees</code> package.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># read example CHM raster</span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"cloud2trees"</span><span class="op">)</span>,<span class="st">"/extdata/chm.tif"</span><span class="op">)</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span></span>
<span><span class="co"># extract trees from raster</span></span>
<span><span class="va">raster2trees_ans</span> <span class="op">&lt;-</span> <span class="fu">cloud2trees</span><span class="fu">::</span><span class="fu"><a href="reference/raster2trees.html">raster2trees</a></span><span class="op">(</span>chm_rast <span class="op">=</span> <span class="va">r</span>, outfolder <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>A spatial data frame with tree crown polygons is returned.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># there are tree crowns</span></span>
<span><span class="va">raster2trees_ans</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 147</span></span>
<span><span class="co">#&gt; Columns: 6</span></span>
<span><span class="co">#&gt; $ treeID        &lt;chr&gt; "1_458054.1_4450092.9", "2_458055.9_4450092.9", "3_45807…</span></span>
<span><span class="co">#&gt; $ tree_height_m &lt;dbl&gt; 4.599, 5.130, 4.610, 8.957, 10.310, 3.023, 4.271, 5.653,…</span></span>
<span><span class="co">#&gt; $ tree_x        &lt;dbl&gt; 458054.1, 458055.9, 458078.4, 458067.6, 458044.9, 458077…</span></span>
<span><span class="co">#&gt; $ tree_y        &lt;dbl&gt; 4450093, 4450093, 4450093, 4450092, 4450092, 4450092, 44…</span></span>
<span><span class="co">#&gt; $ crown_area_m2 &lt;dbl&gt; 0.5625, 0.3750, 0.6250, 3.2500, 5.0000, 0.3750, 0.9375, …</span></span>
<span><span class="co">#&gt; $ geometry      &lt;GEOMETRY [m]&gt; POLYGON ((458054 4450093, 4..., POLYGON ((45805…</span></span></code></pre></div>
<p>Let’s plot these tree crown polygons using <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot2::ggplot()</a></code> with some custom plot settings.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">raster2trees_ans</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">tree_height_m</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Oranges"</span>, name <span class="op">=</span> <span class="st">"tree ht. (m)"</span>, direction <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span>, legend.direction <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-43-1.png" width="100%"></p>
</div>
<div class="section level1">
<h1 id="estimate-tree-dbh-for-a-tree-list">Estimate Tree DBH for a Tree List<a class="anchor" aria-label="anchor" href="#estimate-tree-dbh-for-a-tree-list"></a>
</h1>
<p>If we already have a list of trees with tree coordinate and tree height data, we can estimate tree DBH using a site-specific allometric equation based on FIA data with the <code><a href="reference/trees_dbh.html">trees_dbh()</a></code> function.</p>
<p>We just need to pass a data frame with the columns <code>treeID</code>, <code>tree_x</code>, <code>tree_y</code>, and <code>tree_height_m</code> to the <code><a href="reference/trees_dbh.html">trees_dbh()</a></code> function.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">111</span><span class="op">)</span></span>
<span><span class="co"># a fake tree list</span></span>
<span><span class="va">tl</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    treeID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">21</span><span class="op">)</span></span>
<span>    , tree_x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">21</span>, mean <span class="op">=</span> <span class="fl">458064</span>, sd <span class="op">=</span> <span class="fl">11</span><span class="op">)</span></span>
<span>    , tree_y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">21</span>, mean <span class="op">=</span> <span class="fl">4450074</span>, sd <span class="op">=</span> <span class="fl">11</span><span class="op">)</span></span>
<span>    , tree_height_m <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">21</span>, shape <span class="op">=</span> <span class="op">(</span><span class="fl">7</span><span class="op">/</span><span class="fl">4</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>, rate <span class="op">=</span> <span class="op">(</span><span class="fl">4</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">/</span><span class="fl">7</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Use the <code><a href="reference/trees_dbh.html">trees_dbh()</a></code> function to estimate DBH based on tree height and tree location.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># call the function</span></span>
<span><span class="va">tl_dbh</span> <span class="op">&lt;-</span> <span class="fu">cloud2trees</span><span class="fu">::</span><span class="fu"><a href="reference/trees_dbh.html">trees_dbh</a></span><span class="op">(</span>tree_list <span class="op">=</span> <span class="va">tl</span>, crs <span class="op">=</span> <span class="st">"32613"</span><span class="op">)</span></span></code></pre></div>
<p>What is this data?</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tl_dbh</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 21</span></span>
<span><span class="co">#&gt; Columns: 16</span></span>
<span><span class="co">#&gt; $ treeID                 &lt;chr&gt; "1", "2", "3", "4", "5", "6", "7", "8", "9", "1…</span></span>
<span><span class="co">#&gt; $ tree_x                 &lt;dbl&gt; 458066.6, 458060.4, 458060.6, 458038.7, 458062.…</span></span>
<span><span class="co">#&gt; $ tree_y                 &lt;dbl&gt; 4450078, 4450076, 4450072, 4450078, 4450081, 44…</span></span>
<span><span class="co">#&gt; $ tree_height_m          &lt;dbl&gt; 1.447969, 4.970239, 3.549897, 7.216735, 3.54328…</span></span>
<span><span class="co">#&gt; $ geometry               &lt;POINT [m]&gt; POINT (458066.6 4450078), POINT (458060.4…</span></span>
<span><span class="co">#&gt; $ fia_est_dbh_cm         &lt;dbl&gt; 3.229841, 8.447579, 6.094372, 12.563307, 6.0943…</span></span>
<span><span class="co">#&gt; $ fia_est_dbh_cm_lower   &lt;dbl&gt; 1.939234, 5.030607, 3.647726, 7.505863, 3.64772…</span></span>
<span><span class="co">#&gt; $ fia_est_dbh_cm_upper   &lt;dbl&gt; 4.805320, 12.666605, 9.087239, 18.769135, 9.087…</span></span>
<span><span class="co">#&gt; $ dbh_cm                 &lt;dbl&gt; 3.229841, 8.447579, 6.094372, 12.563307, 6.0943…</span></span>
<span><span class="co">#&gt; $ is_training_data       &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE…</span></span>
<span><span class="co">#&gt; $ dbh_m                  &lt;dbl&gt; 0.03229841, 0.08447579, 0.06094372, 0.12563307,…</span></span>
<span><span class="co">#&gt; $ radius_m               &lt;dbl&gt; 0.01614921, 0.04223790, 0.03047186, 0.06281654,…</span></span>
<span><span class="co">#&gt; $ basal_area_m2          &lt;dbl&gt; 0.0008193176, 0.0056047266, 0.0029170762, 0.012…</span></span>
<span><span class="co">#&gt; $ basal_area_ft2         &lt;dbl&gt; 0.008819135, 0.060329277, 0.031399409, 0.133435…</span></span>
<span><span class="co">#&gt; $ ptcld_extracted_dbh_cm &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…</span></span>
<span><span class="co">#&gt; $ ptcld_predicted_dbh_cm &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…</span></span></code></pre></div>
<p>Let’s look at the relationship between tree height and tree DBH estimated from the FIA plot data.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tl_dbh</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">tree_height_m</span>, y <span class="op">=</span> <span class="va">dbh_cm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"navy"</span>, alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"tree ht. (m)"</span>, y <span class="op">=</span> <span class="st">"tree DBH (cm)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_light</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-47-1.png" width="100%"></p>
<p>We can look at this data spatially too.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># height plot</span></span>
<span><span class="va">plt_ht2</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">tl_dbh</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">tree_height_m</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Oranges"</span>, name <span class="op">=</span> <span class="st">"tree ht. (m)"</span>, direction <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"top"</span>, legend.direction <span class="op">=</span> <span class="st">"horizontal"</span></span>
<span>    , panel.border <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co"># diameter plot</span></span>
<span><span class="va">plt_dbh2</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">tl_dbh</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">dbh_cm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Purples"</span>, name <span class="op">=</span> <span class="st">"tree DBH (cm)"</span>, direction <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"top"</span>, legend.direction <span class="op">=</span> <span class="st">"horizontal"</span></span>
<span>    , panel.border <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co"># combine with patchwork</span></span>
<span><span class="va">plt_ht2</span> <span class="op">+</span> <span class="va">plt_dbh2</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-48-1.png" width="100%"></p>
</div>
<div class="section level1">
<h1 id="estimate-tree-forest-type-for-a-tree-list">Estimate Tree Forest Type for a Tree List<a class="anchor" aria-label="anchor" href="#estimate-tree-forest-type-for-a-tree-list"></a>
</h1>
<p>If we already have a list of trees with tree coordinate, we can use the <code><a href="reference/trees_type.html">trees_type()</a></code> function attach the tree forest type based on the spatial overlap with the <a href="https://www.arcgis.com/home/item.html?id=10760c83b9e44923bd3c18efdaa7319d" class="external-link">Forest Type Groups of the Continental United States</a> data (Wilson 2023). This forest type group layer was developed using data from over 213,000 national forest inventory plots measured during the period 2014-2018 from the FIA program at 30-meter resolution covering the forested extent of the continental US.</p>
<p>We just need to pass a data frame with the columns <code>treeID</code>, <code>tree_x</code>, <code>tree_y</code> to the <code><a href="reference/trees_type.html">trees_type()</a></code> function. We can also use an <code>sf</code> class object with POINT or POLYGON geometry (see <code><a href="https://r-spatial.github.io/sf/reference/st_geometry_type.html" class="external-link">sf::st_geometry_type()</a></code>) and the program will use the data “as-is” and only require the <code>treeID</code> column.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># a fake tree list</span></span>
<span><span class="va">tl</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    treeID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">66</span><span class="op">)</span></span>
<span>    , tree_x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">66</span>, mean <span class="op">=</span> <span class="fl">458000</span>, sd <span class="op">=</span> <span class="fl">75</span><span class="op">)</span></span>
<span>    , tree_y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">66</span>, mean <span class="op">=</span> <span class="fl">4450000</span>, sd <span class="op">=</span> <span class="fl">75</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Use the <code><a href="reference/trees_type.html">trees_type()</a></code> function to extract the FIA forest type group based on tree location. If a tree overlaps with an area that is classified as “non-forest”, the program will search for the nearest forest type to impute a value; we’ll limit the search radius by setting the <code>max_search_dist_m</code> parameter to 88 meters.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># call the function</span></span>
<span><span class="va">tl_type</span> <span class="op">&lt;-</span> <span class="fu">cloud2trees</span><span class="fu">::</span><span class="fu"><a href="reference/trees_type.html">trees_type</a></span><span class="op">(</span>tree_list <span class="op">=</span> <span class="va">tl</span>, crs <span class="op">=</span> <span class="st">"32613"</span>, max_search_dist_m <span class="op">=</span> <span class="fl">88</span><span class="op">)</span></span></code></pre></div>
<p>The return includes our tree list with forest type data (<code>tree_list</code>) as well as the FIA Forest Types Group raster (<code>foresttype_rast</code>) of the area we searched.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tl_type</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "tree_list"       "foresttype_rast"</span></span></code></pre></div>
<p>What is in the tree list data?</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tl_type</span><span class="op">$</span><span class="va">tree_list</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 66</span></span>
<span><span class="co">#&gt; Columns: 7</span></span>
<span><span class="co">#&gt; $ treeID                 &lt;chr&gt; "1", "2", "3", "4", "5", "6", "7", "8", "9", "1…</span></span>
<span><span class="co">#&gt; $ tree_x                 &lt;dbl&gt; 457980.9, 457941.7, 457902.6, 457927.3, 457916.…</span></span>
<span><span class="co">#&gt; $ tree_y                 &lt;dbl&gt; 4449951, 4450079, 4449905, 4449872, 4450004, 44…</span></span>
<span><span class="co">#&gt; $ geometry               &lt;POINT [m]&gt; POINT (457980.9 4449951), POINT (457941.7…</span></span>
<span><span class="co">#&gt; $ forest_type_group_code &lt;chr&gt; "200", "200", "200", "220", "200", "200", "260"…</span></span>
<span><span class="co">#&gt; $ forest_type_group      &lt;chr&gt; "Douglas-fir group", "Douglas-fir group", "Doug…</span></span>
<span><span class="co">#&gt; $ hardwood_softwood      &lt;chr&gt; "Softwood", "Softwood", "Softwood", "Softwood",…</span></span></code></pre></div>
<p>Let’s look at the FIA Forest Type Group data we extracted for the tree list.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tl_type</span><span class="op">$</span><span class="va">tree_list</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">forest_type_group_code</span>, <span class="va">forest_type_group</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 3</span></span>
<span><span class="co">#&gt;   forest_type_group_code forest_type_group                         n</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                  &lt;chr&gt;                                 &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 200                    Douglas-fir group                        39</span></span>
<span><span class="co">#&gt; 2 220                    Ponderosa pine group                      4</span></span>
<span><span class="co">#&gt; 3 260                    Fir / spruce / mountain hemlock group     4</span></span>
<span><span class="co">#&gt; 4 280                    Lodgepole pine group                     19</span></span></code></pre></div>
<p>We can plot our spatial tree list</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># now plot</span></span>
<span><span class="va">tl_type</span><span class="op">$</span><span class="va">tree_list</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color<span class="op">=</span><span class="va">forest_type_group</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"FIA forest\ntype group"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.border <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-54-1.png" width="100%"></p>
<p>Let’s check out the FIA Forest Types Group raster (<code>foresttype_rast</code>) of the area we searched</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r_plt</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">tl_type</span><span class="op">$</span><span class="va">foresttype_rast</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span>xy<span class="op">=</span><span class="cn">T</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>f <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>f <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/is.bool.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span>, fill <span class="op">=</span> <span class="va">f</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"FIA forest type\ngroup code"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_d</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"turbo"</span>, alpha <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">r_plt</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-55-1.png" width="100%"></p>
<p>See the <a href="https://www.arcgis.com/home/item.html?id=10760c83b9e44923bd3c18efdaa7319d" class="external-link">Forest Type Groups of the Continental United States</a> data (Wilson 2023) for a list of possible forest type group codes</p>
<p>Let’s overlay our tree points on the raster data</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r_plt</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">tl_type</span><span class="op">$</span><span class="va">tree_list</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  </span>
<span>      <span class="co"># we have to reproject</span></span>
<span>      <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span></span>
<span>        crs <span class="op">=</span> <span class="va">tl_type</span><span class="op">$</span><span class="va">foresttype_rast</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>          <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span>describe<span class="op">=</span><span class="cn">T</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>          <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">code</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>          <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    , mapping <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="va">forest_type_group</span><span class="op">)</span></span>
<span>    , color <span class="op">=</span> <span class="st">"white"</span></span>
<span>    , size <span class="op">=</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="st">"FIA forest\ntype group"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-56-1.png" width="100%"></p>
</div>
<div class="section level1">
<h1 id="estimate-tree-cbh-for-a-tree-list">Estimate Tree CBH for a Tree List<a class="anchor" aria-label="anchor" href="#estimate-tree-cbh-for-a-tree-list"></a>
</h1>
<p>If you wish to estimate crown base height (CBH) as part of the point cloud processing the <code>LadderFuelsR</code> package (<a href="https://github.com/olgaviedma/LadderFuelsR" class="external-link uri">https://github.com/olgaviedma/LadderFuelsR</a>) and <code>leafR</code> package (<a href="https://github.com/DRAAlmeida/leafR" class="external-link uri">https://github.com/DRAAlmeida/leafR</a>) must be manually installed first.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("remotes")</span></span>
<span><span class="co">## install LadderFuelsR</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span>repo <span class="op">=</span> <span class="st">"olgaviedma/LadderFuelsR"</span>, upgrade <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="co">## install leafR</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span>repo <span class="op">=</span> <span class="st">"DRAAlmeida/leafR"</span>, upgrade <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre></div>
<p>After installing these packages, if we already have spatial polygons of tree crowns and height normalized point cloud data, we can attempt to extract tree CBH from the point cloud using the <code><a href="reference/trees_cbh.html">trees_cbh()</a></code> function.</p>
<p>We just need to pass a <code>sf</code> class object with POLYGON geometry and the columns <code>treeID</code> and <code>tree_height_m</code> and the height normalized point cloud data to the <code><a href="reference/trees_cbh.html">trees_cbh()</a></code> function.</p>
<p>We’ll use the tree crown polygons and normalized point cloud data examples that ship with the <code>cloud2trees</code> package. We will turn on the <code>force_same_crs</code> parameter to force the same projection between the point cloud and polygon since we are confident that data were generated with the same projection. Data generated by a <code>cloud2trees</code> pipeline (e.g. <code><a href="reference/cloud2raster.html">cloud2raster()</a></code>) will always have the same projection.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># read example crown polygons</span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"cloud2trees"</span>,<span class="st">"extdata"</span>, <span class="st">"crowns_poly.gpkg"</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">f</span>, quiet <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="co"># path to the normalized point cloud data</span></span>
<span><span class="va">nlas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"cloud2trees"</span>,<span class="st">"extdata"</span>,<span class="st">"norm_las"</span><span class="op">)</span></span>
<span><span class="co"># call the function</span></span>
<span><span class="va">trees_cbh_ans</span> <span class="op">&lt;-</span> <span class="fu">cloud2trees</span><span class="fu">::</span><span class="fu"><a href="reference/trees_cbh.html">trees_cbh</a></span><span class="op">(</span></span>
<span>  trees_poly <span class="op">=</span> <span class="va">p</span></span>
<span>  , norm_las <span class="op">=</span> <span class="va">nlas</span></span>
<span>  , tree_sample_prop <span class="op">=</span> <span class="fl">0.77</span></span>
<span>  , estimate_missing_cbh <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>What is this data?</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trees_cbh_ans</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">treeID</span>, <span class="va">tree_height_m</span>, <span class="va">tree_cbh_m</span>, <span class="va">is_training_cbh</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 196</span></span>
<span><span class="co">#&gt; Columns: 5</span></span>
<span><span class="co">#&gt; $ treeID          &lt;chr&gt; "1_458054.1_4450092.9", "2_458055.9_4450092.9", "3_458…</span></span>
<span><span class="co">#&gt; $ tree_height_m   &lt;dbl&gt; 4.599, 5.130, 10.641, 4.610, 4.599, 8.957, 10.310, 4.6…</span></span>
<span><span class="co">#&gt; $ tree_cbh_m      &lt;dbl&gt; 4.102961, 4.500000, 8.500000, 2.500000, 4.500000, 4.76…</span></span>
<span><span class="co">#&gt; $ is_training_cbh &lt;lgl&gt; FALSE, TRUE, TRUE, TRUE, TRUE, FALSE, TRUE, FALSE, FAL…</span></span>
<span><span class="co">#&gt; $ geom            &lt;MULTIPOLYGON [m]&gt; MULTIPOLYGON (((458054 4450..., MULTIPOLY…</span></span></code></pre></div>
<p>Let’s look at the relationship between tree height and tree CBH as extracted from the point cloud. Note, that we do not expect a perfect linear relationship between tree height and CBH throughout the entire height range because CBH is also determined spatially (e.g. as a fire moves through a stand).</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trees_cbh_ans</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">is_training_cbh</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">tree_height_m</span>, y <span class="op">=</span> <span class="va">tree_cbh_m</span>, color<span class="op">=</span><span class="va">is_training_cbh</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"tree ht. (m)"</span>, y <span class="op">=</span> <span class="st">"tree CBH (m)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/breaks_extended.html" class="external-link">extended_breaks</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">12</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/breaks_extended.html" class="external-link">extended_breaks</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">14</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_d</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.8</span>, name <span class="op">=</span> <span class="st">"is CBH\nfrom cloud?"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_light</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-59-1.png" width="100%"></p>
<p>We can look at this data spatially too.</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trees_cbh_ans</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">is_training_cbh</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">tree_cbh_m</span>, color<span class="op">=</span><span class="va">is_training_cbh</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_d</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.8</span>, name <span class="op">=</span> <span class="st">"is CBH\nfrom cloud?"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Greens"</span>, name <span class="op">=</span> <span class="st">"tree CBH (m)"</span>, direction <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"top"</span>, legend.direction <span class="op">=</span> <span class="st">"horizontal"</span></span>
<span>    , panel.border <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span></span>
<span>    color <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">3</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-60-1.png" width="100%"></p>
</div>
<div class="section level1">
<h1 id="estimate-tree-hmd-for-a-tree-list">Estimate Tree HMD for a Tree List<a class="anchor" aria-label="anchor" href="#estimate-tree-hmd-for-a-tree-list"></a>
</h1>
<p>If you wish to extract the height of the maximum crown diameter (HMD) using height normalized point cloud data (e.g. as exported by <code><a href="reference/cloud2raster.html">cloud2raster()</a></code>) the <code><a href="reference/trees_hmd.html">trees_hmd()</a></code> function and the <code>estimate_tree_hmd</code> in the <code><a href="reference/cloud2trees.html">cloud2trees()</a></code> function may be relevant to your interests.</p>
<p>We just need to pass a <code>sf</code> class object with POLYGON geometry and the columns <code>treeID</code> and <code>tree_height_m</code> and the height normalized point cloud data to the <code><a href="reference/trees_hmd.html">trees_hmd()</a></code> function. The function returns the data with the added columns: <code>max_crown_diam_height_m</code>, <code>is_training_hmd</code>.</p>
<p>We’ll use the tree crown polygons and normalized point cloud data examples that ship with the <code>cloud2trees</code> package.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># read example crown polygons</span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"cloud2trees"</span>,<span class="st">"extdata"</span>, <span class="st">"crowns_poly.gpkg"</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">f</span>, quiet <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="co"># path to the normalized point cloud data</span></span>
<span><span class="va">nlas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"cloud2trees"</span><span class="op">)</span>,<span class="st">"/extdata/norm_las"</span><span class="op">)</span></span>
<span><span class="co"># call the function</span></span>
<span><span class="va">trees_hmd_ans</span> <span class="op">&lt;-</span> <span class="fu">cloud2trees</span><span class="fu">::</span><span class="fu"><a href="reference/trees_hmd.html">trees_hmd</a></span><span class="op">(</span></span>
<span>  trees_poly <span class="op">=</span> <span class="va">p</span></span>
<span>  , norm_las <span class="op">=</span> <span class="va">nlas</span></span>
<span>  , estimate_missing_hmd <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>What is this data?</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trees_hmd_ans</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">treeID</span>, <span class="va">tree_height_m</span>, <span class="va">max_crown_diam_height_m</span>, <span class="va">is_training_hmd</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 196</span></span>
<span><span class="co">#&gt; Columns: 5</span></span>
<span><span class="co">#&gt; $ treeID                  &lt;chr&gt; "1_458054.1_4450092.9", "2_458055.9_4450092.9"…</span></span>
<span><span class="co">#&gt; $ tree_height_m           &lt;dbl&gt; 4.599, 5.130, 10.641, 4.610, 4.599, 8.957, 10.…</span></span>
<span><span class="co">#&gt; $ max_crown_diam_height_m &lt;dbl&gt; 3.531745, 4.681000, 8.943000, 3.151000, 3.2190…</span></span>
<span><span class="co">#&gt; $ is_training_hmd         &lt;lgl&gt; FALSE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRU…</span></span>
<span><span class="co">#&gt; $ geom                    &lt;MULTIPOLYGON [m]&gt; MULTIPOLYGON (((458054 4450..., M…</span></span></code></pre></div>
<p>Let’s look at the relationship between tree height and tree HMD as extracted from the point cloud. Note, that we do not expect a perfect linear relationship between tree height and HMD throughout the entire height range because HMD is also determined spatially (e.g. as a fire moves through a stand).</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trees_hmd_ans</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">is_training_cbh</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">tree_height_m</span>, y <span class="op">=</span> <span class="va">max_crown_diam_height_m</span>, color<span class="op">=</span><span class="va">is_training_hmd</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"tree ht. (m)"</span>, y <span class="op">=</span> <span class="st">"tree HMD (m)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/breaks_extended.html" class="external-link">extended_breaks</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">12</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/breaks_extended.html" class="external-link">extended_breaks</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">14</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_d</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"turbo"</span>, begin <span class="op">=</span> <span class="fl">0.2</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, name <span class="op">=</span> <span class="st">"is HMD\nfrom cloud?"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_light</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-63-1.png" width="100%"></p>
<p>We can look at this data spatially too.</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trees_hmd_ans</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">is_training_hmd</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">max_crown_diam_height_m</span>, color<span class="op">=</span><span class="va">is_training_hmd</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_d</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"turbo"</span>, begin <span class="op">=</span> <span class="fl">0.2</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, name <span class="op">=</span> <span class="st">"is HMD\nfrom cloud?"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Greys"</span>, name <span class="op">=</span> <span class="st">"tree HMD (m)"</span>, direction <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"top"</span>, legend.direction <span class="op">=</span> <span class="st">"horizontal"</span></span>
<span>    , panel.border <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span></span>
<span>    color <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">3</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-64-1.png" width="100%"></p>
</div>
<div class="section level1">
<h1 id="estimate-tree-biomass-for-a-tree-list">Estimate Tree Biomass for a Tree List<a class="anchor" aria-label="anchor" href="#estimate-tree-biomass-for-a-tree-list"></a>
</h1>
<p>The <code><a href="reference/cloud2trees.html">cloud2trees()</a></code> package includes methods for estimating individual tree biomass in kilograms, or the component biomass of the tree crown in kilograms.</p>
<p>Currently supported methods for estimating biomass include:</p>
<ul>
<li>Tree crown biomass in kilograms:
<ul>
<li>“landfire” - based on <a href="https://landfire.gov/fuel/cbd" class="external-link">LANDFIRE’s Forest Canopy Bulk Density (CBD)</a> data (<code><a href="reference/trees_biomass_landfire.html">trees_biomass_landfire()</a></code>)</li>
<li>“cruz” - based on <a href="https://scholar.google.com/scholar?cluster=316241498622221569&amp;oi=gsb&amp;hl=en&amp;as_sdt=0,5" class="external-link">Cruz et al. (2003)</a> canopy fuel stratum equations (<code><a href="reference/trees_biomass_cruz.html">trees_biomass_cruz()</a></code>)</li>
</ul>
</li>
</ul>
<p>The <code><a href="reference/trees_biomass.html">trees_biomass()</a></code> function streamlines the process for estimating individual tree biomass in kilograms, or the component biomass of the tree crown in kilograms. Users can select one, some, or all of the methods available in the package for estimating biomass.</p>
<p>We just need to pass a data frame with the columns <code>treeID</code>, <code>tree_x</code>, <code>tree_y</code> to the <code>trees_biomass*()</code> function. We can also use an <code>sf</code> class object with POINT or POLYGON geometry (see <code><a href="https://r-spatial.github.io/sf/reference/st_geometry_type.html" class="external-link">sf::st_geometry_type()</a></code>) and the program will use the data “as-is” and only require the <code>treeID</code> column.</p>
<p>Since estimating tree crown biomass using stand-based fuel estimates requires back-transformation to the tree level, the <code><a href="reference/trees_biomass_landfire.html">trees_biomass_landfire()</a></code>, <code><a href="reference/trees_biomass_cruz.html">trees_biomass_cruz()</a></code>, and <code><a href="reference/trees_biomass.html">trees_biomass()</a></code> if using the Cruz or LANDFIRE methods also require the following data attributes:</p>
<ul>
<li>
<code>crown_area_m2</code>, <code>tree_height_m</code> (e.g. as exported by <code><a href="reference/raster2trees.html">raster2trees()</a></code>)</li>
<li>
<code>tree_cbh_m</code> (e.g. as exported by <code><a href="reference/trees_cbh.html">trees_cbh()</a></code>)</li>
<li>and one of <code>dbh_cm</code>, <code>dbh_m</code>, or <code>basal_area_m2</code> (e.g. as exported by <code><a href="reference/trees_dbh.html">trees_dbh()</a></code>)</li>
</ul>
<p>We’ll use the tree crown polygons that ship with the <code>cloud2trees</code> package.</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># read example crown polygons</span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"cloud2trees"</span>,<span class="st">"extdata"</span>, <span class="st">"crowns_poly.gpkg"</span><span class="op">)</span></span>
<span><span class="va">tl</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">f</span>, quiet <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="trees_biomass">
<code>trees_biomass()</code><a class="anchor" aria-label="anchor" href="#trees_biomass"></a>
</h2>
<p>The <code><a href="reference/trees_biomass.html">trees_biomass()</a></code> function streamlines the process for estimating individual tree biomass in kilograms, or the component biomass of the tree crown in kilograms. Users can select one, some, or all of the methods available in the package for estimating biomass. The following function calls are equivalent:</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># trees_biomass with method = "landfire"</span></span>
<span><span class="fu"><a href="reference/trees_biomass.html">trees_biomass</a></span><span class="op">(</span><span class="va">tree_list</span>, method <span class="op">=</span> <span class="st">"landfire"</span><span class="op">)</span></span>
<span><span class="co"># is equivalent to</span></span>
<span><span class="fu"><a href="reference/trees_biomass_landfire.html">trees_biomass_landfire</a></span><span class="op">(</span><span class="va">tree_list</span><span class="op">)</span></span></code></pre></div>
<p>We’ll use the <code><a href="reference/trees_biomass.html">trees_biomass()</a></code> function and ask for both the LANDFIRE and the Cruz et al. (2003) estimates of tree crown biomass in kilograms with the argument <code>method = c("landfire","cruz")</code></p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># call trees_biomass and get multiple biomass estimates</span></span>
<span><span class="va">trees_biomass_ans</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/trees_biomass.html">trees_biomass</a></span><span class="op">(</span>tree_list <span class="op">=</span> <span class="va">tl</span>, method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"landfire"</span>,<span class="st">"cruz"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>what did we get back?</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trees_biomass_ans</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "tree_list"                "stand_cell_data_landfire"</span></span>
<span><span class="co">#&gt; [3] "stand_cell_data_cruz"</span></span></code></pre></div>
<p>check out the tree list data</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trees_biomass_ans</span><span class="op">$</span><span class="va">tree_list</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 196</span></span>
<span><span class="co">#&gt; Columns: 36</span></span>
<span><span class="co">#&gt; $ treeID                    &lt;chr&gt; "1_458054.1_4450092.9", "2_458055.9_4450092.…</span></span>
<span><span class="co">#&gt; $ tree_height_m             &lt;dbl&gt; 4.599, 5.130, 10.641, 4.610, 4.599, 8.957, 1…</span></span>
<span><span class="co">#&gt; $ tree_x                    &lt;dbl&gt; 458054.1, 458055.9, 458064.9, 458078.4, 4580…</span></span>
<span><span class="co">#&gt; $ tree_y                    &lt;dbl&gt; 4450093, 4450093, 4450093, 4450093, 4450092,…</span></span>
<span><span class="co">#&gt; $ crown_area_m2             &lt;dbl&gt; 0.1875, 0.3750, 1.8750, 0.7500, 0.3750, 3.37…</span></span>
<span><span class="co">#&gt; $ fia_est_dbh_cm            &lt;dbl&gt; 7.319132, 8.019020, 19.016688, 7.319132, 7.3…</span></span>
<span><span class="co">#&gt; $ fia_est_dbh_cm_lower      &lt;dbl&gt; 3.255010, 3.515282, 8.424208, 3.255010, 3.25…</span></span>
<span><span class="co">#&gt; $ fia_est_dbh_cm_upper      &lt;dbl&gt; 12.58250, 13.93920, 32.91103, 12.58250, 12.5…</span></span>
<span><span class="co">#&gt; $ dbh_cm                    &lt;dbl&gt; 7.319132, 8.019020, 19.016688, 7.319132, 7.3…</span></span>
<span><span class="co">#&gt; $ is_training_data          &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FA…</span></span>
<span><span class="co">#&gt; $ dbh_m                     &lt;dbl&gt; 0.07319132, 0.08019020, 0.19016688, 0.073191…</span></span>
<span><span class="co">#&gt; $ radius_m                  &lt;dbl&gt; 0.03659566, 0.04009510, 0.09508344, 0.036595…</span></span>
<span><span class="co">#&gt; $ basal_area_m2             &lt;dbl&gt; 0.004207353, 0.005050479, 0.028402703, 0.004…</span></span>
<span><span class="co">#&gt; $ basal_area_ft2            &lt;dbl&gt; 0.04528795, 0.05436335, 0.30572669, 0.045287…</span></span>
<span><span class="co">#&gt; $ ptcld_extracted_dbh_cm    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ ptcld_predicted_dbh_cm    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ tree_cbh_m                &lt;dbl&gt; 2.770816, 2.750028, 1.500000, 1.500000, 2.77…</span></span>
<span><span class="co">#&gt; $ is_training_cbh           &lt;lgl&gt; FALSE, FALSE, TRUE, TRUE, FALSE, TRUE, TRUE,…</span></span>
<span><span class="co">#&gt; $ comp_trees_per_ha         &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ comp_relative_tree_height &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ comp_dist_to_nearest_m    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">#&gt; $ forest_type_group_code    &lt;chr&gt; "200", "200", "200", "200", "200", "200", "2…</span></span>
<span><span class="co">#&gt; $ forest_type_group         &lt;chr&gt; "Douglas-fir group", "Douglas-fir group", "D…</span></span>
<span><span class="co">#&gt; $ hardwood_softwood         &lt;chr&gt; "Softwood", "Softwood", "Softwood", "Softwoo…</span></span>
<span><span class="co">#&gt; $ cruz_stand_id             &lt;dbl&gt; 32, 32, 32, 33, 32, 32, 31, 33, 32, 31, 31, …</span></span>
<span><span class="co">#&gt; $ cruz_tree_kg_per_m3       &lt;dbl&gt; 1.0196573, 1.0196573, 1.0196573, 1.8371350, …</span></span>
<span><span class="co">#&gt; $ cruz_stand_kg_per_m3      &lt;dbl&gt; 0.017647375, 0.017647375, 0.017647375, 0.003…</span></span>
<span><span class="co">#&gt; $ cruz_crown_biomass_kg     &lt;dbl&gt; 0.2330152, 0.6066891, 11.6508594, 2.8567451,…</span></span>
<span><span class="co">#&gt; $ landfire_stand_id         &lt;dbl&gt; 41, 41, 41, 42, 41, 42, 41, 42, 42, 41, 41, …</span></span>
<span><span class="co">#&gt; $ crown_dia_m               &lt;dbl&gt; 0.4886025, 0.6909883, 1.5450968, 0.9772050, …</span></span>
<span><span class="co">#&gt; $ crown_length_m            &lt;dbl&gt; 1.8281841, 2.3799726, 9.1409998, 3.1100001, …</span></span>
<span><span class="co">#&gt; $ crown_volume_m3           &lt;dbl&gt; 0.2285230, 0.5949931, 11.4262497, 1.5550001,…</span></span>
<span><span class="co">#&gt; $ landfire_tree_kg_per_m3   &lt;dbl&gt; 0.5285632, 0.5285632, 0.5285632, 1.1615116, …</span></span>
<span><span class="co">#&gt; $ landfire_stand_kg_per_m3  &lt;dbl&gt; 0.11, 0.11, 0.11, 0.08, 0.11, 0.08, 0.11, 0.…</span></span>
<span><span class="co">#&gt; $ landfire_crown_biomass_kg &lt;dbl&gt; 0.1207889, 0.3144915, 6.0394953, 1.8061507, …</span></span>
<span><span class="co">#&gt; $ geometry                  &lt;POINT [m]&gt; POINT (458054.1 4450093), POINT (45805…</span></span></code></pre></div>
<p>that’s a lot of extra information…the <code>cruz_crown_biomass_kg</code> and <code>landfire_crown_biomass_kg</code> columns include estimates of tree crown biomass in kilograms that we are after</p>
<p>plot tree LANDFIRE and Cruz crown biomass estimate</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="co"># plot tree landfire crown biomass estimate</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">trees_biomass_ans</span><span class="op">$</span><span class="va">tree_list</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">tree_height_m</span></span>
<span>      , y <span class="op">=</span> <span class="va">landfire_crown_biomass_kg</span></span>
<span>      , color <span class="op">=</span> <span class="va">crown_area_m2</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># plot tree cruz crown biomass estimate</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">trees_biomass_ans</span><span class="op">$</span><span class="va">tree_list</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">tree_height_m</span></span>
<span>      , y <span class="op">=</span> <span class="va">cruz_crown_biomass_kg</span></span>
<span>      , color <span class="op">=</span> <span class="va">crown_area_m2</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># patchwork it</span></span>
<span><span class="va">p1</span><span class="op">/</span><span class="va">p2</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-69-1.png" width="100%"></p>
<p>the estimates look similar but not exactly the same. let’s plot them against each other</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get the max for the upper limit scale</span></span>
<span><span class="va">ul</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span></span>
<span>  <span class="va">trees_biomass_ans</span><span class="op">$</span><span class="va">tree_list</span><span class="op">$</span><span class="va">cruz_crown_biomass_kg</span></span>
<span>  , <span class="va">trees_biomass_ans</span><span class="op">$</span><span class="va">tree_list</span><span class="op">$</span><span class="va">landfire_crown_biomass_kg</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># plot tree landfire vs. cruz crown biomass estimate</span></span>
<span><span class="va">trees_biomass_ans</span><span class="op">$</span><span class="va">tree_list</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">landfire_crown_biomass_kg</span>, y <span class="op">=</span> <span class="va">cruz_crown_biomass_kg</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, se<span class="op">=</span><span class="cn">F</span>, color <span class="op">=</span> <span class="st">"gray"</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">tree_height_m</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">ul</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">ul</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-70-1.png" width="100%"></p>
<p>let’s check out the LANDFIRE stand data</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trees_biomass_ans</span><span class="op">$</span><span class="va">stand_cell_data_landfire</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">trees</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 4</span></span>
<span><span class="co">#&gt; Columns: 19</span></span>
<span><span class="co">#&gt; $ landfire_stand_id        &lt;dbl&gt; 41, 42, 50, 51</span></span>
<span><span class="co">#&gt; $ x                        &lt;dbl&gt; -799740, -799710, -799740, -799710</span></span>
<span><span class="co">#&gt; $ y                        &lt;dbl&gt; 1949370, 1949370, 1949340, 1949340</span></span>
<span><span class="co">#&gt; $ area                     &lt;dbl&gt; 900, 900, 900, 900</span></span>
<span><span class="co">#&gt; $ pct_overlap              &lt;dbl&gt; 1.0000000, 0.9901794, 0.9117767, 0.8549631</span></span>
<span><span class="co">#&gt; $ overlap_area_m2          &lt;dbl&gt; 900.0000, 891.1614, 820.5990, 769.4668</span></span>
<span><span class="co">#&gt; $ overlap_area_ha          &lt;dbl&gt; 0.09000000, 0.08911614, 0.08205990, 0.07694668</span></span>
<span><span class="co">#&gt; $ rast_epsg_code           &lt;chr&gt; "5070", "5070", "5070", "5070"</span></span>
<span><span class="co">#&gt; $ trees                    &lt;int&gt; 76, 57, 39, 24</span></span>
<span><span class="co">#&gt; $ basal_area_m2            &lt;dbl&gt; 0.9394342, 0.4925679, 0.3439884, 0.2819664</span></span>
<span><span class="co">#&gt; $ mean_crown_length_m      &lt;dbl&gt; 4.267942, 3.194076, 3.995164, 4.211663</span></span>
<span><span class="co">#&gt; $ mean_crown_dia_m         &lt;dbl&gt; 1.660573, 1.185514, 1.654449, 1.501857</span></span>
<span><span class="co">#&gt; $ sum_crown_volume_m3      &lt;dbl&gt; 799.3865, 196.0506, 403.6156, 195.4602</span></span>
<span><span class="co">#&gt; $ basal_area_m2_per_ha     &lt;dbl&gt; 10.438158, 5.527257, 4.191918, 3.664439</span></span>
<span><span class="co">#&gt; $ trees_per_ha             &lt;dbl&gt; 844.4444, 639.6147, 475.2626, 311.9043</span></span>
<span><span class="co">#&gt; $ landfire_stand_kg_per_m3 &lt;dbl&gt; 0.11, 0.08, 0.08, 0.08</span></span>
<span><span class="co">#&gt; $ kg_per_m2                &lt;dbl&gt; 0.4694736, 0.2555261, 0.3196131, 0.3369330</span></span>
<span><span class="co">#&gt; $ biomass_kg               &lt;dbl&gt; 422.5263, 227.7150, 262.2742, 259.2588</span></span>
<span><span class="co">#&gt; $ landfire_tree_kg_per_m3  &lt;dbl&gt; 0.5285632, 1.1615116, 0.6498119, 1.3264021</span></span></code></pre></div>
<p>this data includes the cell data (where, a “stand” is represented by a raster cell) from the LANDFIRE Forest Canopy Bulk Density (CBD) data</p>
<p>we can use this stand/cell data as raster data and overlay the tree points…let’s do this for the LANDFIRE data</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get the projection for the stand cell data</span></span>
<span><span class="va">epsg_code</span> <span class="op">&lt;-</span> <span class="va">trees_biomass_ans</span><span class="op">$</span><span class="va">stand_cell_data_landfire</span><span class="op">$</span><span class="va">rast_epsg_code</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># plot the stand cell data with trees overlaid</span></span>
<span><span class="va">trees_biomass_ans</span><span class="op">$</span><span class="va">stand_cell_data_landfire</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">trees</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>,y<span class="op">=</span><span class="va">y</span>,fill <span class="op">=</span> <span class="va">landfire_stand_kg_per_m3</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"gray44"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>,y<span class="op">=</span><span class="va">y</span>,label <span class="op">=</span> <span class="va">trees</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">trees_biomass_ans</span><span class="op">$</span><span class="va">tree_list</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="va">epsg_code</span><span class="op">)</span></span>
<span>    , <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">cruz_crown_biomass_kg</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"landfire\nstand kg/m3"</span>, color <span class="op">=</span> <span class="st">"landfire\ncrown kg"</span>, caption <span class="op">=</span> <span class="st">"# trees shown in cell"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"rocket"</span>, na.value <span class="op">=</span> <span class="st">"gray"</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"viridis"</span>, na.value <span class="op">=</span> <span class="st">"gray22"</span>, begin <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-72-1.png" width="100%"></p>
</div>
</div>

  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/georgewoolsey/cloud2trees/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/georgewoolsey/cloud2trees/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>GPL (&gt;= 3)</small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing cloud2trees</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>George Woolsey <br><small class="roles"> Author, maintainer </small>   </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by George Woolsey.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
